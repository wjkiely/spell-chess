<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spell Chess Team Game</title>
    
    <link rel="icon" type="image/png" href="/spell-chess/assets/favicons/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/svg+xml" href="/spell-chess/assets/favicons/favicon.svg">
    <link rel="shortcut icon" href="/spell-chess/assets/favicons/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/spell-chess/assets/favicons/apple-touch-icon.png">
    <link rel="manifest" href="/spell-chess/assets/favicons/site.webmanifest">
    
    <style>
        /* Global reset/base */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            box-sizing: border-box;
        }
        *, *:before, *:after {
            box-sizing: inherit;
        }

        /* Styles for home page view */
        body.home-view {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 100vh;
            padding: 20px;
        }
        body.home-view #game-content-wrapper {
            display: none;
        }
        body.home-view #home-page-content {
            display: block;
        }

        /* Styles for game view (Desktop First) */
        body.game-view {
            display: flex;
            flex-direction: column; 
            align-items: center; 
            padding: 20px;
            background-color: #fff;
            min-height: 100vh;
            color: #333;
        }
        body.game-view #home-page-content {
            display: none;
        }
        #game-content-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative; /* Context for absolute menus */
            width: 100%;
            max-width: 1200px; /* Adjust as needed */
        }
        #announcement-box { 
            position: relative; /* For close button positioning */
            display: block; 
            width: 100%;
            max-width: 1100px; 
            margin: 0 auto 20px auto; 
            padding: 15px;
            border: 2px solid #007bff;
            background-color: #e7f3ff;
            border-radius: 8px;
            text-align: center;
            font-size: 0.95em;
            line-height: 1.6;
        }
        #announcement-box h3 {
            margin-top: 0;
            color: #0056b3;
        }
        #announcement-box a {
            color: #0056b3;
            font-weight: bold;
            text-decoration: none;
        }
        #announcement-box a:hover {
            text-decoration: underline;
        }


        #home-page-content h1 {
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        #start-game-button {
            padding: 15px 30px;
            font-size: 1.2em;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            margin-bottom: 5px;
        }
        #start-game-button:hover {
            background-color: #45a049;
        }

        .game-container {
            display: flex;
            flex-wrap: wrap; 
            gap: 20px;
            align-items: flex-start;
            width: 100%;
            margin: 0 auto;
            justify-content: center;
        }

        .main-game-area { 
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 480px; 
            flex-shrink: 0;
            position: relative; /* For arrow canvas positioning */
        }
        #arrow-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: auto;
            aspect-ratio: 1 / 1;
            pointer-events: none; /* Allows clicks to go through to the board */
            z-index: 5;
        }
        #mobile-navigation-controls {
            display: none;
        }
        
        .board-action-button {
            background: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s, transform 0.2s;
            flex-shrink: 0;
        }
        .board-action-button:hover {
            background-color: #e0e0e0;
            transform: scale(1.1);
        }

        .status-area {
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #e9ecef;
            min-height: 70px;
            width: 100%; 
            text-align: center; 
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .rules-area {
            position: relative; /* For positioning close button */
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #f8f9fa;
            width: 100%;
            margin-top: 10px; 
            font-size: 0.9em;
            line-height: 1.5;
        }
        .rules-area h4 {
            margin-top: 0;
            color: #333;
        }
        .rules-area ul {
            padding-left: 20px;
            margin-bottom: 0;
        }
        .rules-area li {
            margin-bottom: 5px;
        }

        .close-button {
            position: absolute;
            top: 2px;
            right: 8px;
            font-size: 22px;
            font-weight: bold;
            color: #aaa;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }
        .close-button:hover {
            color: #333;
        }

        .chessboard {
            width: 480px;
            height: 480px;
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            border: 2px solid #333;
            transition: transform 0.5s;
        }
        .chessboard.flipped {
            transform: rotate(180deg);
        }
        .square {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 40px;
            cursor: pointer;
            user-select: none;
            position: relative;
        }
        .square.light { background-color: #f0d9b5; }
        .square.dark { background-color: #b58863; }
        .square.selected { background-color: #6a994e; }
        .square.highlight-history {
            box-shadow: inset 0 0 10px 4px rgba(255, 0, 0, 0.6);
        }

        .square.valid-move-hint::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(167, 201, 87, 0.5);
            box-shadow: inset 0 0 0 2px #6a994e;
            z-index: 1;
        }
        .square.active-freeze-zone {
            box-shadow: inset 0 0 0 1000px rgba(173, 216, 230, 0.35);
        }
        .square.jumpable-on-square {
            box-shadow: inset 0 0 0 1000px rgba(255, 255, 0, 0.25),
                        inset 0 0 0 3px #DAA520;
        }
        .square.freeze-outline-top { border-top: 3px solid #007bff; }
        .square.freeze-outline-bottom { border-bottom: 3px solid #007bff; }
        .square.freeze-outline-left { border-left: 3px solid #007bff; }
        .square.freeze-outline-right { border-right: 3px solid #007bff; }

        .square-freeze-emoji {
            position: absolute;
            top: 1px;
            right: 1px;
            font-size: 15px;
            opacity: 0.9;
            z-index: 1;
            pointer-events: none;
        }
        .piece {
            position: relative;
            z-index: 2;
            transition: transform 0.5s;
        }
        .chessboard.flipped .piece {
            transform: rotate(180deg);
        }
        .chessboard.colored-pieces .piece.white-piece-alternative {
            color: white; 
            text-shadow: -0.3px -0.3px 0 #555, -0.3px 0.3px 0 #555, 0.3px -0.3px 0 #555, 0.3px 0.3px 0 #555;
        }

        .controls {
            width: 250px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex-shrink: 0;
        }
        .controls.flipped {
            flex-direction: column-reverse;
        }
        .player-info { padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        .player-info h3 { margin-top: 0; margin-bottom: 5px; text-align: center;}
        .spell-button, .reset-button, .promotion-button, .menu-item { 
            padding: 8px 12px;
            cursor: pointer;
            border: 1px solid #555;
            border-radius: 4px;
            background-color: #f0f0f0;
            width: 100%;
        }
        .promotion-button {
            margin-bottom: 5px;
        }
        .spell-button:disabled, .reset-button:disabled, .menu-item:disabled { cursor: not-allowed; background-color: #ccc; color: #777; }
        .spell-button.targeting { background-color: #add8e6; }
        
        .spell-container { margin-bottom: 10px; }
        .spell-icon-container { display: flex; gap: 4px; margin-top: 5px; height: 20px; }
        .spell-icon { font-size: 18px; }
        .cooldown-bar { width: 100%; height: 8px; background-color: #e9ecef; border: 1px solid #ccc; border-radius: 4px; margin-top: 4px; overflow: hidden; }
        .cooldown-bar-fill { height: 100%; background-color: #adb5bd; transition: width 0.3s ease-in-out;}
        .cooldown-bar-fill.jump { background: linear-gradient(to right, #ffc107, #ff9800); }
        .cooldown-bar-fill.freeze { background: linear-gradient(to right, #00bfff, #007bff); }
        .cooldown-bar-fill.ready { background-color: #28a745; }


        #cancel-spell-container { 
            height: 40px; /* Reserve space to prevent layout shifts */
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        #cancel-button {
            width: auto;
            flex-shrink: 0;
            padding-left: 20px;
            padding-right: 20px;
        }

        #import-game-area {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-top: 10px;
            display: none; /* Hidden by default */
        }
        #import-game-textarea {
            width: 100%;
            min-height: 80px;
            margin-bottom: 10px;
            resize: vertical;
        }
        .import-controls {
            display: flex;
            gap: 10px;
        }

        .navigation-controls {
            display: flex;
            gap: 5px;
            width: 100%;
            flex-wrap: nowrap;
            align-items: center;
        }
        .navigation-controls .nav-button {
            flex: 1;
            padding: 6px;
            font-size: 1.2em;
            font-weight: bold;
        }
        .navigation-controls .icon-button {
            flex: 0 0 auto; /* Don't grow or shrink */
            width: 36px;
            height: 36px;
            padding: 4px;
            font-size: 20px;
        }


        .notation-wrapper {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 360px;
            flex-shrink: 0;
            position: relative;
        }

        .notation-area {
            padding: 10px;
            border: 1px solid #ccc;
            height: 330px; /* Increased height */
            overflow-y: auto;
            resize: vertical; /* Make it resizable */
            background-color: #f8f9fa;
            min-height: 100px;
        }
        .notation-area .notation-line {
            margin-bottom: 2px;
        }
        .notation-area .notation-turn-number {
            font-weight: bold;
            margin-right: 2px; 
        }
        .notation-area .notation-move {
            cursor: pointer;
            text-decoration: underline;
            color: #0056b3;
            margin-right: 5px;
            padding: 2px 4px;
            border-radius: 3px;
        }
        .notation-area .notation-move:hover {
            color: #007bff;
            background-color: #e9ecef;
        }
         .notation-area .notation-move.current-move {
            background-color: #a7c957;
            color: white;
            text-decoration: none;
        }

        #promotion-choices {
            margin-top: 10px;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        /* --- New Menu UI --- */
        #top-right-controls {
            position: absolute;
            top: -5px;
            right: 24px;
            display: flex;
            gap: 0px;
            z-index: 20;
        }
        .menu-toggle-button {
            font-size: 24px;
            background: none;
            border: none;
            cursor: pointer;
            color: #888;
            padding: 5px;
            transition: color 0.2s;
        }
        .menu-toggle-button:hover { color: #333; }

        .dropdown-menu {
            position: absolute;
            right: 0;
            top: 35px;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            z-index: 21;
            width: 220px;
            overflow: hidden;
            /* Animation properties */
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: opacity 0.2s ease, transform 0.2s ease, visibility 0.2s;
        }
        .dropdown-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        .menu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            text-align: left;
            border: none;
            border-radius: 0;
            border-bottom: 1px solid #eee;
        }
        .menu-item:last-child { border-bottom: none; }
        .menu-item:hover { background-color: #f0f0f0; }
        .menu-separator {
            border: 0;
            height: 1px;
            background-color: #ddd;
            margin: 0;
        }
        .menu-item-icon {
            font-size: 1.2em;
            width: 20px;
            text-align: center;
        }


        /* --- MOBILE STYLES --- */
        @media (max-width: 768px) {
            body.game-view {
                padding: 10px; 
            }
            .game-container {
                flex-direction: column; 
                align-items: center; 
                gap: 15px;
                flex-wrap: nowrap; 
            }
            .main-game-area { 
                 width: 90vw;
                 max-width: 400px; 
                 order: 1; 
                 gap: 10px;
            }
            .chessboard {
                width: 100%; 
                height: auto; 
                aspect-ratio: 1 / 1; 
                max-width: none; 
                max-height: none;
            }
            #mobile-navigation-controls {
                display: flex;
            }
            .notation-wrapper .navigation-controls {
                display: none;
            }
            .status-area {
                 width: 100%; 
                 max-width: none; 
                 text-align: center;
            }
            .rules-area {
                font-size: 0.8em;
            }
            .square {
                font-size: 7vw;
            }
            @media (min-width: 450px) and (max-width: 768px) {
                .square {
                    font-size: 32px;
                }
            }
            .controls {
                order: 2; 
                width: 90vw;
                max-width: 480px;
            }
            .player-info {
                display: flex;
                flex-direction: column;
                align-items: stretch;
            }
             .player-info small {
                display: none; /* Hide text cooldown on mobile */
             }
            .notation-wrapper {
                order: 3;
                width: 90vw;
                max-width: 480px;
            }
            .notation-area {
                height: 150px;
                width: 100%;
            }
             #promotion-choices {
                order: -1;
            }
        }
        @media (max-width: 400px) {
            .square {
                font-size: 28px;
            }
            .player-info h3 {
                font-size: 1em;
            }
            .spell-button, .reset-button, .promotion-button {
                padding: 6px 10px;
                font-size: 0.9em;
            }
            .main-game-area { 
                width: 95vw; 
            }
            .controls, .notation-wrapper {
                 width: 95vw;
            }
        }

        /* --- DARK THEME STYLES --- */
        body.dark-theme {
            background-color: #2b2b2b;
            color: #e0e0e0;
        }
        body.dark-theme .square.light { background-color: #779556; }
        body.dark-theme .square.dark { background-color: #597343; }
        body.dark-theme .square.selected { background-color: #baca44; }
        
        body.dark-theme .square.valid-move-hint::before {
            background-color: rgba(255, 255, 0, 0.4);
            box-shadow: inset 0 0 0 2px #d4d12a;
        }
        body.dark-theme .square.highlight-history {
            box-shadow: inset 0 0 10px 4px rgba(255, 69, 0, 0.7);
        }
        body.dark-theme .square.active-freeze-zone {
            box-shadow: inset 0 0 0 1000px rgba(135, 206, 250, 0.3);
        }
        body.dark-theme .square.jumpable-on-square {
            box-shadow: inset 0 0 0 1000px rgba(255, 255, 100, 0.2),
                        inset 0 0 0 3px #FADA5E;
        }
        body.dark-theme .square.freeze-outline-top,
        body.dark-theme .square.freeze-outline-bottom,
        body.dark-theme .square.freeze-outline-left,
        body.dark-theme .square.freeze-outline-right {
            border-color: #58a6ff;
        }
        
        body.dark-theme .piece:not(.white-piece-alternative) {
            color: #1c1c1c; 
        }

        body.dark-theme .status-area,
        body.dark-theme .rules-area,
        body.dark-theme .player-info,
        body.dark-theme .notation-area,
        body.dark-theme #import-game-area {
            background-color: #3c3c3c;
            border-color: #555;
            color: #e0e0e0;
        }
        body.dark-theme #import-game-textarea {
            background-color: #3c3c3c;
            color: #e0e0e0;
            border-color: #555;
        }
        body.dark-theme #import-game-textarea::placeholder {
            color: #a9a9a9;
        }
        body.dark-theme .rules-area h4, body.dark-theme .player-info h3 { color: #f0f0f0; }

        body.dark-theme .spell-button,
        body.dark-theme .reset-button,
        body.dark-theme .promotion-button,
        body.dark-theme .menu-item {
            background-color: #555;
            color: #e0e0e0;
            border-color: #777;
        }
        body.dark-theme .spell-button:not(:disabled):hover,
        body.dark-theme .reset-button:not(:disabled):hover,
        body.dark-theme .promotion-button:not(:disabled):hover,
        body.dark-theme .menu-item:hover {
            background-color: #666;
        }
        body.dark-theme .spell-button.targeting { background-color: #4a90e2; }
        body.dark-theme .spell-button:disabled,
        body.dark-theme .reset-button:disabled,
        body.dark-theme .menu-item:disabled {
            background-color: #444;
            color: #888;
            border-color: #666;
        }
        body.dark-theme .close-button { color: #888; }
        body.dark-theme .close-button:hover { color: #ccc; }
        body.dark-theme .board-action-button { background: #3c3c3c; border-color: #555; color: #ccc;}
        body.dark-theme .board-action-button:hover { background: #4d4d4d; }

        body.dark-theme .cooldown-bar { background-color: #2b2b2b; border-color: #555; }

        body.dark-theme .notation-area .notation-move { color: #8ab4f8; }
        body.dark-theme .notation-area .notation-move:hover { background-color: #4a4a4a; color: #a1c6fa; }
        body.dark-theme .notation-area .notation-move.current-move { background-color: #81b333; color: #1e1e1e; text-decoration: none; }
        body.dark-theme .notation-area .notation-move.current-move:hover { background-color: #8fbc3f; }

        body.dark-theme #announcement-box {
            background-color: #1c2b3a;
            border-color: #0099ff;
            color: #cde7ff;
        }
        body.dark-theme #announcement-box h3, body.dark-theme #announcement-box a {
            color: #66b3ff;
        }
        body.dark-theme #start-game-button {
            background-color: #28a745;
        }
        body.dark-theme #start-game-button:hover {
            background-color: #218838;
        }

        body.dark-theme .menu-toggle-button { color: #aaa; }
        body.dark-theme .menu-toggle-button:hover { color: #eee; }
        body.dark-theme .dropdown-menu { background-color: #3c3c3c; border-color: #555; }
        body.dark-theme .menu-item { border-bottom-color: #4a4a4a; }
        body.dark-theme .menu-separator { background-color: #555; }

    </style>
</head>
<body class="vsc-initialized game-view dark-theme"> 
    <script id="theme-initializer">
        // Apply theme immediately to prevent FOUC (Flash of Unstyled Content)
        (function() {
            // Dark theme is default. Remove it only if light theme is explicitly saved.
            const theme = localStorage.getItem('spellChessTheme');
            if (theme === 'light') {
                document.body.classList.remove('dark-theme');
            }
        })();
    </script>

    <div id="home-page-content">
        <h1>Spell Chess</h1>
        <button id="start-game-button">Two Player Game</button>
    </div>

    <div id="game-content-wrapper">
        <div id="announcement-box">
            <button id="close-announcement-button" class="close-button">×</button>
            <p style="text-align: center;"><strong>Spell Chess Team Game</strong></p>
            <div style="text-align: left;">
                <ul>
                    <li>Below is the <a href="https://wjkiely.github.io/spell-chess/current.html">current position</a> of a 24 hours per move <a href="https://www.chess.com/variants/spell-chess/" target="_blank">spell chess</a> team game that began on June 1st, 2025. (Also see the <a href="https://www.chess.com/clubs/forum/view/official-thread-to-follow-the-spell-chess-team-game?page=1#comment-115161744" target="_blank">Official Game thread</a>.)</li>
                    <li>Find your teammates and discuss the game on Chess.com in the <a href="https://www.chess.com/club/white-team-spell-chess-game-2025-06-01" target="_blank">White Team club</a> or the <a href="https://www.chess.com/club/black-team-spell-chess-game-2025-06-01" target="_blank">Black Team club</a>.</li>
                    <li>Everyone is welcome to join a team and participate. Bookmark this page to make following along easier!</li>
                </ul>
            </div>
            <p style="text-align: center;">
                <a href="https://docs.google.com/forms/d/e/1FAIpQLSdd2nHpV4Xx6Q_REa1ca5_wrjWauCK7K0l53jikvEBWpFr6ag/viewform" target="_blank">Vote for a White move</a> (see the <a href="https://docs.google.com/spreadsheets/d/e/2PACX-1vQYT0IqhxSloR-xK6J0YERefzH3HZL4X1xaehRKDvCra4q87QueuUm27Sj7Bl9wWEr7EPDGt3fZVPME/pubhtml?gid=795963797&amp;single=true" target="_blank">White Team's votes</a>) | <a href="https://docs.google.com/forms/d/e/1FAIpQLSeh9HDSdQjVRw3g0n-7KT61Xj0FrvuYvyS3ARwsKW2VuEWFyQ/viewform" target="_blank">Vote for a Black move</a> (see the <a href="https://docs.google.com/spreadsheets/d/e/2PACX-1vS14TcrlcQiZvdWMFVdbgI_QJBQ_K-Aw-JJZPW57yTrkXTmoEWRB1BQdMtuDRw7olHc2JijSmAKdvx0/pubhtml?gid=764572409&amp;single=true" target="_blank">Black Team's votes</a>)
            </p>
        </div>

        <div class="game-container">
            <div class="main-game-area">
                <div id="chessboard" class="chessboard colored-pieces"><div class="square light" data-r="0" data-c="0"></div><div class="square dark" data-r="0" data-c="1"></div><div class="square light" data-r="0" data-c="2"><span class="piece" data-piece-id="piece-0-0-1751772337326">♜</span></div><div class="square dark" data-r="0" data-c="3"></div><div class="square light" data-r="0" data-c="4"><span class="piece" data-piece-id="piece-0-4-1751772337326">♚</span></div><div class="square dark" data-r="0" data-c="5"></div><div class="square light" data-r="0" data-c="6"><span class="piece" data-piece-id="piece-0-7-1751772337326">♜</span></div><div class="square dark" data-r="0" data-c="7"></div><div class="square dark" data-r="1" data-c="0"><span class="piece" data-piece-id="piece-1-0-1751772337326">♟</span></div><div class="square light" data-r="1" data-c="1"></div><div class="square dark" data-r="1" data-c="2"></div><div class="square light" data-r="1" data-c="3"><span class="piece" data-piece-id="piece-1-3-1751772337326">♟</span></div><div class="square dark" data-r="1" data-c="4"></div><div class="square light" data-r="1" data-c="5"><span class="piece" data-piece-id="piece-1-5-1751772337326">♟</span></div><div class="square dark" data-r="1" data-c="6"></div><div class="square light" data-r="1" data-c="7"></div><div class="square light" data-r="2" data-c="0"></div><div class="square dark" data-r="2" data-c="1"><span class="piece" data-piece-id="piece-0-6-1751772337326">♞</span></div><div class="square light" data-r="2" data-c="2"><span class="piece" data-piece-id="piece-0-1-1751772337326">♞</span></div><div class="square dark" data-r="2" data-c="3"></div><div class="square light" data-r="2" data-c="4"><span class="piece" data-piece-id="piece-1-4-1751772337326">♟</span></div><div class="square dark" data-r="2" data-c="5"></div><div class="square light" data-r="2" data-c="6"></div><div class="square dark" data-r="2" data-c="7"><span class="piece white-piece-alternative" data-piece-id="piece-7-7-1751772337326">♜</span></div><div class="square dark" data-r="3" data-c="0"></div><div class="square light" data-r="3" data-c="1"><span class="piece" data-piece-id="piece-1-1-1751772337326">♟</span></div><div class="square dark" data-r="3" data-c="2"></div><div class="square light" data-r="3" data-c="3"></div><div class="square dark" data-r="3" data-c="4"><span class="piece white-piece-alternative" data-piece-id="piece-6-4-1751772337326">♟</span></div><div class="square light" data-r="3" data-c="5"></div><div class="square dark" data-r="3" data-c="6"></div><div class="square light" data-r="3" data-c="7"></div><div class="square light" data-r="4" data-c="0"></div><div class="square dark" data-r="4" data-c="1"></div><div class="square light" data-r="4" data-c="2"></div><div class="square dark" data-r="4" data-c="3"></div><div class="square light" data-r="4" data-c="4"></div><div class="square dark" data-r="4" data-c="5"><span class="piece white-piece-alternative" data-piece-id="piece-6-5-1751772337326">♟</span></div><div class="square light" data-r="4" data-c="6"></div><div class="square dark" data-r="4" data-c="7"></div><div class="square dark" data-r="5" data-c="0"><span class="piece white-piece-alternative" data-piece-id="piece-6-1-1751772337326">♟</span></div><div class="square light" data-r="5" data-c="1"><span class="piece white-piece-alternative" data-piece-id="piece-7-5-1751772337326">♝</span></div><div class="square dark" data-r="5" data-c="2"><span class="piece white-piece-alternative" data-piece-id="piece-6-2-1751772337326">♟</span></div><div class="square light" data-r="5" data-c="3"><span class="piece white-piece-alternative" data-piece-id="piece-6-3-1751772337326">♟</span></div><div class="square dark" data-r="5" data-c="4"></div><div class="square light" data-r="5" data-c="5"><span class="piece" data-piece-id="piece-0-2-1751772337326">♝</span></div><div class="square dark" data-r="5" data-c="6"></div><div class="square light" data-r="5" data-c="7"></div><div class="square light" data-r="6" data-c="0"><span class="piece white-piece-alternative" data-piece-id="piece-6-0-1751772337326">♟</span></div><div class="square dark" data-r="6" data-c="1"></div><div class="square light" data-r="6" data-c="2"></div><div class="square dark" data-r="6" data-c="3"><span class="piece white-piece-alternative" data-piece-id="piece-7-2-1751772337326">♝</span></div><div class="square light" data-r="6" data-c="4"><span class="piece white-piece-alternative" data-piece-id="piece-7-6-1751772337326">♞</span></div><div class="square dark" data-r="6" data-c="5"></div><div class="square light" data-r="6" data-c="6"></div><div class="square dark" data-r="6" data-c="7"><span class="piece white-piece-alternative" data-piece-id="piece-6-7-1751772337326">♟</span></div><div class="square dark" data-r="7" data-c="0"><span class="piece white-piece-alternative" data-piece-id="piece-7-0-1751772337326">♜</span></div><div class="square light" data-r="7" data-c="1"></div><div class="square dark" data-r="7" data-c="2"></div><div class="square light" data-r="7" data-c="3"></div><div class="square dark" data-r="7" data-c="4"><span class="piece white-piece-alternative" data-piece-id="piece-7-4-1751772337326">♚</span></div><div class="square light" data-r="7" data-c="5"></div><div class="square dark" data-r="7" data-c="6"></div><div class="square light" data-r="7" data-c="7"></div></div> 
                <canvas id="arrow-canvas" width="480" height="480"></canvas>
                 <div id="mobile-navigation-controls" class="navigation-controls">
                    <button id="history-back-button-mobile" class="reset-button nav-button">&lt;</button>
                    <button id="history-forward-button-mobile" class="reset-button nav-button" disabled="">&gt;</button>
                    <button id="copy-notation-button-mobile" class="reset-button icon-button" title="Copy Game Notation" aria-label="Copy Game Notation">📋</button>
                </div>
                <div id="status-area" class="status-area">Black's turn.</div>
                <div id="rules-area" class="rules-area" style="display: block;">
                    <button id="close-rules-button" class="close-button">×</button>
                    <h4>Spell Chess Rules:</h4>
                    <ul>
                        <li>Standard chess rules apply. Checkmate or capture your opponent's king to win.</li>
                        <li>A player may cast a spell before making their move.</li>
                        <li>Each player starts with <strong>two Jump</strong> spells and <strong>five Freeze</strong> spells.</li>
                        <li><strong>Jump Spell:</strong> Target any piece. For your current turn and your opponent's next turn, that piece is jumpable by other pieces as if it is not there.</li>
                        <li><strong>Freeze Spell:</strong> Target any square. All pieces in a 3x3 area around the target square are frozen and cannot move on your turn or your opponent's next turn. Frozen pieces cannot put a king in check or checkmate. Frozen kings still attack.</li>
                        <li>Spells have a 3-turn cooldown before they can be used again.</li>
                    </ul>
                </div>
            </div>
            <div class="controls">
                <div id="black-player-info" class="player-info">
                    <h3>Black</h3>
                    <div class="spell-container">
                        <button id="black-jump-spell" class="spell-button" disabled="">Cast Jump (<span id="black-jump-count">0</span>)</button>
                        <div class="cooldown-bar"><div id="black-jump-cooldown-bar" class="cooldown-bar-fill jump" style="width: 0%;"></div></div>
                        <small id="black-jump-cooldown">Jump spells depleted</small>
                        <div id="black-jump-icons" class="spell-icon-container"></div>
                    </div>
                    <div class="spell-container">
                        <button id="black-freeze-spell" class="spell-button">Cast Freeze (<span id="black-freeze-count">5</span>)</button>
                        <div class="cooldown-bar"><div id="black-freeze-cooldown-bar" class="cooldown-bar-fill freeze ready" style="width: 100%;"></div></div>
                        <small id="black-freeze-cooldown">Ready</small>
                        <div id="black-freeze-icons" class="spell-icon-container"><span class="spell-icon">❄️</span><span class="spell-icon">❄️</span><span class="spell-icon">❄️</span><span class="spell-icon">❄️</span><span class="spell-icon">❄️</span></div>
                    </div>
                </div>

                <div id="cancel-spell-container">
                    <button id="flip-board-icon" class="board-action-button" title="Flip Board" aria-label="Flip Board">🔄</button>
                    <button id="cancel-button" class="reset-button" style="display: none;">Cancel Spell</button>
                    <button id="clear-drawings-icon" class="board-action-button" title="Clear Drawings" aria-label="Clear All Drawings">🧹</button>
                </div>

                <div id="white-player-info" class="player-info">
                    <h3>White</h3>
                     <div class="spell-container">
                        <button id="white-jump-spell" class="spell-button" disabled="">Cast Jump (<span id="white-jump-count">0</span>)</button>
                        <div class="cooldown-bar"><div id="white-jump-cooldown-bar" class="cooldown-bar-fill jump" style="width: 0%;"></div></div>
                        <small id="white-jump-cooldown">Jump spells depleted</small>
                        <div id="white-jump-icons" class="spell-icon-container"></div>
                    </div>
                    <div class="spell-container">
                        <button id="white-freeze-spell" class="spell-button" disabled="">Cast Freeze (<span id="white-freeze-count">5</span>)</button>
                        <div class="cooldown-bar"><div id="white-freeze-cooldown-bar" class="cooldown-bar-fill freeze ready" style="width: 100%;"></div></div>
                        <small id="white-freeze-cooldown">Ready</small>
                        <div id="white-freeze-icons" class="spell-icon-container"><span class="spell-icon">❄️</span><span class="spell-icon">❄️</span><span class="spell-icon">❄️</span><span class="spell-icon">❄️</span><span class="spell-icon">❄️</span></div>
                    </div>
                </div>
                
                <div id="promotion-choices" style="display: none;">
                    <button class="promotion-button" data-promote="Q">Promote to Queen</button>
                    <button class="promotion-button" data-promote="R">Promote to Rook</button>
                    <button class="promotion-button" data-promote="B">Promote to Bishop</button>
                    <button class="promotion-button" data-promote="N">Promote to Knight</button>
                </div>
            </div>
            <div class="notation-wrapper">
                <!-- New Top Right Menu/Settings Controls -->
                <div id="top-right-controls">
                    <div style="position: relative;">
                        <button id="menu-toggle-button" class="menu-toggle-button" aria-label="Open Game Menu">☰</button>
                        <div id="main-menu" class="dropdown-menu">
                            <button id="show-announcement-menu-item" class="menu-item">Spell Chess Team Game</button>
                            <button id="show-rules-menu-item" class="menu-item">Show Rules</button>
                            <hr class="menu-separator">
                            <button id="get-link-menu-item" class="menu-item">Get Game Link</button>
                            <button id="import-game-menu-item" class="menu-item">Import Game</button>
                            <button id="download-game-menu-item" class="menu-item">Download Game</button>
                            <hr class="menu-separator">
                            <button id="reset-game-menu-item" class="menu-item">Reset Game</button>
                            <button id="go-home-menu-item" class="menu-item">Home</button>
                        </div>
                    </div>
                    <div style="position: relative;">
                        <button id="settings-toggle-button" class="menu-toggle-button" aria-label="Open Settings Menu">⚙️</button>
                        <div id="settings-menu" class="dropdown-menu">
                            <button id="toggle-theme-menu-item" class="menu-item"><span class="menu-item-icon">☀️</span><span class="menu-item-text">Switch to Light Theme</span></button>
                            <button id="toggle-pieces-menu-item" class="menu-item"><span class="menu-item-icon">🎨</span><span class="menu-item-text">Use Standard Pieces</span></button>
                        </div>
                    </div>
                </div>
                <div id="notation-area" class="notation-area" style="height: 426px;"><div class="notation-line"><span class="notation-turn-number">1. </span><span class="notation-move" data-ply-snapshot-index="1">e4</span> <span class="notation-move" data-ply-snapshot-index="2">c6</span> </div><div class="notation-line"><span class="notation-turn-number">2. </span><span class="notation-move" data-ply-snapshot-index="3">Bc4</span> <span class="notation-move" data-ply-snapshot-index="4">e6</span> </div><div class="notation-line"><span class="notation-turn-number">3. </span><span class="notation-move" data-ply-snapshot-index="5">c3</span> <span class="notation-move" data-ply-snapshot-index="6">b5</span> </div><div class="notation-line"><span class="notation-turn-number">4. </span><span class="notation-move" data-ply-snapshot-index="7">Bb3</span> <span class="notation-move" data-ply-snapshot-index="8">c5</span> </div><div class="notation-line"><span class="notation-turn-number">5. </span><span class="notation-move" data-ply-snapshot-index="9">Qf3</span> <span class="notation-move" data-ply-snapshot-index="10">Qe7</span> </div><div class="notation-line"><span class="notation-turn-number">6. </span><span class="notation-move" data-ply-snapshot-index="11">d3</span> <span class="notation-move" data-ply-snapshot-index="12">Bb7</span> </div><div class="notation-line"><span class="notation-turn-number">7. </span><span class="notation-move" data-ply-snapshot-index="13">Qg3</span> <span class="notation-move" data-ply-snapshot-index="14">c4</span> </div><div class="notation-line"><span class="notation-turn-number">8. </span><span class="notation-move" data-ply-snapshot-index="15">Na3</span> <span class="notation-move" data-ply-snapshot-index="16">Bc6</span> </div><div class="notation-line"><span class="notation-turn-number">9. </span><span class="notation-move" data-ply-snapshot-index="17">Bxc4</span> <span class="notation-move" data-ply-snapshot-index="18">jump@e7 Bxa3</span> </div><div class="notation-line"><span class="notation-turn-number">10. </span><span class="notation-move" data-ply-snapshot-index="19">bxa3</span> <span class="notation-move" data-ply-snapshot-index="20">Nf6</span> </div><div class="notation-line"><span class="notation-turn-number">11. </span><span class="notation-move" data-ply-snapshot-index="21">Qxg7</span> <span class="notation-move" data-ply-snapshot-index="22">Rg8</span> </div><div class="notation-line"><span class="notation-turn-number">12. </span><span class="notation-move" data-ply-snapshot-index="23">jump@f7 Qxe7+</span> <span class="notation-move" data-ply-snapshot-index="24">Kxe7</span> </div><div class="notation-line"><span class="notation-turn-number">13. </span><span class="notation-move" data-ply-snapshot-index="25">Bb3</span> <span class="notation-move" data-ply-snapshot-index="26">jump@e4 Bxg2</span> </div><div class="notation-line"><span class="notation-turn-number">14. </span><span class="notation-move" data-ply-snapshot-index="27">e5</span> <span class="notation-move" data-ply-snapshot-index="28">Nd5</span> </div><div class="notation-line"><span class="notation-turn-number">15. </span><span class="notation-move" data-ply-snapshot-index="29">jump@h2 Rxh7</span> <span class="notation-move" data-ply-snapshot-index="30">Nc6</span> </div><div class="notation-line"><span class="notation-turn-number">16. </span><span class="notation-move" data-ply-snapshot-index="31">Rh5</span> <span class="notation-move" data-ply-snapshot-index="32">Ke8</span> </div><div class="notation-line"><span class="notation-turn-number">17. </span><span class="notation-move" data-ply-snapshot-index="33">Bd2</span> <span class="notation-move" data-ply-snapshot-index="34">Rc8</span> </div><div class="notation-line"><span class="notation-turn-number">18. </span><span class="notation-move" data-ply-snapshot-index="35">f4</span> <span class="notation-move" data-ply-snapshot-index="36">Nb6</span> </div><div class="notation-line"><span class="notation-turn-number">19. </span><span class="notation-move" data-ply-snapshot-index="37">Ne2</span> <span class="notation-move" data-ply-snapshot-index="38">Bf3</span> </div><div class="notation-line"><span class="notation-turn-number">20. </span><span class="notation-move current-move" data-ply-snapshot-index="39">Rh6</span> </div></div>
                <div class="navigation-controls">
                    <button id="history-back-button-desktop" class="reset-button nav-button">&lt;</button>
                    <button id="history-forward-button-desktop" class="reset-button nav-button" disabled="">&gt;</button>
                    <button id="copy-notation-button-desktop" class="reset-button icon-button" title="Copy Game Notation" aria-label="Copy Game Notation">📋</button>
                </div>
                <div id="import-game-area" style="display: none;">
                    <textarea id="import-game-textarea" placeholder="Paste game notation here..."></textarea>
                    <div class="import-controls">
                        <button id="load-game-button" class="reset-button">Load Game</button>
                        <button id="cancel-import-button" class="reset-button">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script id="savedGameStateData" type="application/json">{"board":[[null,null,{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null],[null,{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true}],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,null,null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null],[{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null]],"currentPlayer":"black","gameTurnNumber":20,"plyCount":39,"spells":{"white":{"jump":0,"freeze":5,"jumpLastUsedTurn":15,"freezeLastUsedTurn":0},"black":{"jump":0,"freeze":5,"jumpLastUsedTurn":13,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"moveLog":[{"turn":1,"player":"white","notation":"e4","actions":["e2-e4"],"plySnapshotIndex":1},{"turn":1,"player":"black","notation":"c6","actions":["c7-c6"],"plySnapshotIndex":2},{"turn":2,"player":"white","notation":"Bc4","actions":["f1-c4"],"plySnapshotIndex":3},{"turn":2,"player":"black","notation":"e6","actions":["e7-e6"],"plySnapshotIndex":4},{"turn":3,"player":"white","notation":"c3","actions":["c2-c3"],"plySnapshotIndex":5},{"turn":3,"player":"black","notation":"b5","actions":["b7-b5"],"plySnapshotIndex":6},{"turn":4,"player":"white","notation":"Bb3","actions":["c4-b3"],"plySnapshotIndex":7},{"turn":4,"player":"black","notation":"c5","actions":["c6-c5"],"plySnapshotIndex":8},{"turn":5,"player":"white","notation":"Qf3","actions":["d1-f3"],"plySnapshotIndex":9},{"turn":5,"player":"black","notation":"Qe7","actions":["d8-e7"],"plySnapshotIndex":10},{"turn":6,"player":"white","notation":"d3","actions":["d2-d3"],"plySnapshotIndex":11},{"turn":6,"player":"black","notation":"Bb7","actions":["c8-b7"],"plySnapshotIndex":12},{"turn":7,"player":"white","notation":"Qg3","actions":["f3-g3"],"plySnapshotIndex":13},{"turn":7,"player":"black","notation":"c4","actions":["c5-c4"],"plySnapshotIndex":14},{"turn":8,"player":"white","notation":"Na3","actions":["b1-a3"],"plySnapshotIndex":15},{"turn":8,"player":"black","notation":"Bc6","actions":["b7-c6"],"plySnapshotIndex":16},{"turn":9,"player":"white","notation":"Bxc4","actions":["b3-c4"],"plySnapshotIndex":17},{"turn":9,"player":"black","notation":"jump@e7 Bxa3","actions":["j@e7","f8-a3"],"plySnapshotIndex":18},{"turn":10,"player":"white","notation":"bxa3","actions":["b2-a3"],"plySnapshotIndex":19},{"turn":10,"player":"black","notation":"Nf6","actions":["g8-f6"],"plySnapshotIndex":20},{"turn":11,"player":"white","notation":"Qxg7","actions":["g3-g7"],"plySnapshotIndex":21},{"turn":11,"player":"black","notation":"Rg8","actions":["h8-g8"],"plySnapshotIndex":22},{"turn":12,"player":"white","notation":"jump@f7 Qxe7+","actions":["j@f7","g7-e7"],"plySnapshotIndex":23},{"turn":12,"player":"black","notation":"Kxe7","actions":["e8-e7"],"plySnapshotIndex":24},{"turn":13,"player":"white","notation":"Bb3","actions":["c4-b3"],"plySnapshotIndex":25},{"turn":13,"player":"black","notation":"jump@e4 Bxg2","actions":["j@e4","c6-g2"],"plySnapshotIndex":26},{"turn":14,"player":"white","notation":"e5","actions":["e4-e5"],"plySnapshotIndex":27},{"turn":14,"player":"black","notation":"Nd5","actions":["f6-d5"],"plySnapshotIndex":28},{"turn":15,"player":"white","notation":"jump@h2 Rxh7","actions":["j@h2","h1-h7"],"plySnapshotIndex":29},{"turn":15,"player":"black","notation":"Nc6","actions":["b8-c6"],"plySnapshotIndex":30},{"turn":16,"player":"white","notation":"Rh5","actions":["h7-h5"],"plySnapshotIndex":31},{"turn":16,"player":"black","notation":"Ke8","actions":["e7-e8"],"plySnapshotIndex":32},{"turn":17,"player":"white","notation":"Bd2","actions":["c1-d2"],"plySnapshotIndex":33},{"turn":17,"player":"black","notation":"Rc8","actions":["a8-c8"],"plySnapshotIndex":34},{"turn":18,"player":"white","notation":"f4","actions":["f2-f4"],"plySnapshotIndex":35},{"turn":18,"player":"black","notation":"Nb6","actions":["d5-b6"],"plySnapshotIndex":36},{"turn":19,"player":"white","notation":"Ne2","actions":["g1-e2"],"plySnapshotIndex":37},{"turn":19,"player":"black","notation":"Bf3","actions":["g2-f3"],"plySnapshotIndex":38},{"turn":20,"player":"white","notation":"Rh6","actions":["h5-h6"],"plySnapshotIndex":39}],"enPassantTarget":null,"castlingRights":{"white":{"K":false,"Q":true},"black":{"k":false,"q":false}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"history":[{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"q","color":"black","id":"piece-0-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"N","color":"white","id":"piece-7-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"Q","color":"white","id":"piece-7-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"white","gameTurnNumber":1,"plyCount":0,"spells":{"white":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0},"black":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":true,"q":true}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":0},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"q","color":"black","id":"piece-0-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,null,null,null,null,null,null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"N","color":"white","id":"piece-7-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"Q","color":"white","id":"piece-7-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"black","gameTurnNumber":1,"plyCount":1,"spells":{"white":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0},"black":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":{"r":5,"c":4},"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":true,"q":true}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":0},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"q","color":"black","id":"piece-0-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,{"type":"p","color":"black","id":"piece-1-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,null,null,null,null,null,null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"N","color":"white","id":"piece-7-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"Q","color":"white","id":"piece-7-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"white","gameTurnNumber":2,"plyCount":2,"spells":{"white":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0},"black":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":true,"q":true}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":1},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"q","color":"black","id":"piece-0-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,{"type":"p","color":"black","id":"piece-1-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,null,null,null,null,null,null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"N","color":"white","id":"piece-7-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"Q","color":"white","id":"piece-7-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"black","gameTurnNumber":2,"plyCount":3,"spells":{"white":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0},"black":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":true,"q":true}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":2},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"q","color":"black","id":"piece-0-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,{"type":"p","color":"black","id":"piece-1-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,null,null,null,null,null,null,null],[null,null,{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,null,null,null,null,null,null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"N","color":"white","id":"piece-7-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"Q","color":"white","id":"piece-7-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"white","gameTurnNumber":3,"plyCount":4,"spells":{"white":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0},"black":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":true,"q":true}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":3},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"q","color":"black","id":"piece-0-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,{"type":"p","color":"black","id":"piece-1-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,null,null,null,null,null,null,null],[null,null,{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,null,{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"N","color":"white","id":"piece-7-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"Q","color":"white","id":"piece-7-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"black","gameTurnNumber":3,"plyCount":5,"spells":{"white":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0},"black":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":true,"q":true}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":4},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"q","color":"black","id":"piece-0-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,{"type":"p","color":"black","id":"piece-1-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null,null],[null,null,{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,null,{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"N","color":"white","id":"piece-7-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"Q","color":"white","id":"piece-7-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"white","gameTurnNumber":4,"plyCount":6,"spells":{"white":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0},"black":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":{"r":2,"c":1},"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":true,"q":true}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":5},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"q","color":"black","id":"piece-0-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,{"type":"p","color":"black","id":"piece-1-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null,null],[null,null,null,null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"N","color":"white","id":"piece-7-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"Q","color":"white","id":"piece-7-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"black","gameTurnNumber":4,"plyCount":7,"spells":{"white":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0},"black":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":true,"q":true}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":6},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"q","color":"black","id":"piece-0-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,null,null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null],[null,null,null,null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"N","color":"white","id":"piece-7-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"Q","color":"white","id":"piece-7-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"white","gameTurnNumber":5,"plyCount":8,"spells":{"white":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0},"black":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":true,"q":true}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":7},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"q","color":"black","id":"piece-0-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,null,null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null],[null,null,null,null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"Q","color":"white","id":"piece-7-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"N","color":"white","id":"piece-7-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"black","gameTurnNumber":5,"plyCount":9,"spells":{"white":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0},"black":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":true,"q":true}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":8},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"q","color":"black","id":"piece-0-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,null,null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null],[null,null,null,null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"Q","color":"white","id":"piece-7-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"N","color":"white","id":"piece-7-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"white","gameTurnNumber":6,"plyCount":10,"spells":{"white":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0},"black":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":true,"q":true}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":9},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"q","color":"black","id":"piece-0-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,null,null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null],[null,null,null,null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"Q","color":"white","id":"piece-7-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"N","color":"white","id":"piece-7-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"black","gameTurnNumber":6,"plyCount":11,"spells":{"white":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0},"black":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":true,"q":true}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":10},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"q","color":"black","id":"piece-0-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,null,null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null],[null,null,null,null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"Q","color":"white","id":"piece-7-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"N","color":"white","id":"piece-7-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"white","gameTurnNumber":7,"plyCount":12,"spells":{"white":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0},"black":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":true,"q":true}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":11},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"q","color":"black","id":"piece-0-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,null,null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null],[null,null,null,null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"Q","color":"white","id":"piece-7-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"N","color":"white","id":"piece-7-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"black","gameTurnNumber":7,"plyCount":13,"spells":{"white":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0},"black":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":true,"q":true}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":12},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"q","color":"black","id":"piece-0-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,null,null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null,null],[null,null,{"type":"p","color":"black","id":"piece-1-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"Q","color":"white","id":"piece-7-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"N","color":"white","id":"piece-7-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"white","gameTurnNumber":8,"plyCount":14,"spells":{"white":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0},"black":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":true,"q":true}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":13},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"q","color":"black","id":"piece-0-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,null,null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null,null],[null,null,{"type":"p","color":"black","id":"piece-1-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[{"type":"N","color":"white","id":"piece-7-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"Q","color":"white","id":"piece-7-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"black","gameTurnNumber":8,"plyCount":15,"spells":{"white":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0},"black":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":true,"q":true}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":14},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"q","color":"black","id":"piece-0-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null,null],[null,null,{"type":"p","color":"black","id":"piece-1-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[{"type":"N","color":"white","id":"piece-7-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"Q","color":"white","id":"piece-7-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"white","gameTurnNumber":9,"plyCount":16,"spells":{"white":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0},"black":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":true,"q":true}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":15},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"q","color":"black","id":"piece-0-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null,null],[null,null,{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[{"type":"N","color":"white","id":"piece-7-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"Q","color":"white","id":"piece-7-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"black","gameTurnNumber":9,"plyCount":17,"spells":{"white":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0},"black":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":true,"q":true}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":16},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"q","color":"black","id":"piece-0-3-1751772337326","isFrozen":false,"isJumpable":true,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null,null],[null,null,{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[{"type":"b","color":"black","id":"piece-0-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"Q","color":"white","id":"piece-7-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"white","gameTurnNumber":10,"plyCount":18,"spells":{"white":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0},"black":{"jump":1,"freeze":5,"jumpLastUsedTurn":9,"freezeLastUsedTurn":0}},"activeSpells":[{"type":"jump","targetId":"piece-0-3-1751772337326","expiresAtPly":19}],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":true,"q":true}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":17},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"q","color":"black","id":"piece-0-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null,null],[null,null,{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"Q","color":"white","id":"piece-7-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"black","gameTurnNumber":10,"plyCount":19,"spells":{"white":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0},"black":{"jump":1,"freeze":5,"jumpLastUsedTurn":9,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":true,"q":true}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":18},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"q","color":"black","id":"piece-0-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null,null],[null,null,{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"Q","color":"white","id":"piece-7-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"white","gameTurnNumber":11,"plyCount":20,"spells":{"white":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0},"black":{"jump":1,"freeze":5,"jumpLastUsedTurn":9,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":true,"q":true}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":19},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"q","color":"black","id":"piece-0-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"Q","color":"white","id":"piece-7-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null,null],[null,null,{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"black","gameTurnNumber":11,"plyCount":21,"spells":{"white":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0},"black":{"jump":1,"freeze":5,"jumpLastUsedTurn":9,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":true,"q":true}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":20},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"q","color":"black","id":"piece-0-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"Q","color":"white","id":"piece-7-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null,null],[null,null,{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"white","gameTurnNumber":12,"plyCount":22,"spells":{"white":{"jump":2,"freeze":5,"jumpLastUsedTurn":0,"freezeLastUsedTurn":0},"black":{"jump":1,"freeze":5,"jumpLastUsedTurn":9,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":false,"q":true}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":21},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"Q","color":"white","id":"piece-7-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":true,"hasMoved":false},null,{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null,null],[null,null,{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"black","gameTurnNumber":12,"plyCount":23,"spells":{"white":{"jump":1,"freeze":5,"jumpLastUsedTurn":12,"freezeLastUsedTurn":0},"black":{"jump":1,"freeze":5,"jumpLastUsedTurn":9,"freezeLastUsedTurn":0}},"activeSpells":[{"type":"jump","targetId":"piece-1-5-1751772337326","expiresAtPly":24}],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":false,"q":true}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":22},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,null,{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null,null],[null,null,{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"white","gameTurnNumber":13,"plyCount":24,"spells":{"white":{"jump":1,"freeze":5,"jumpLastUsedTurn":12,"freezeLastUsedTurn":0},"black":{"jump":1,"freeze":5,"jumpLastUsedTurn":9,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":false,"q":false}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":23},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,null,{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null,null],[null,null,null,null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"black","gameTurnNumber":13,"plyCount":25,"spells":{"white":{"jump":1,"freeze":5,"jumpLastUsedTurn":12,"freezeLastUsedTurn":0},"black":{"jump":1,"freeze":5,"jumpLastUsedTurn":9,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":false,"q":false}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":24},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,null,{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,null,null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null,null,null],[null,null,null,null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":true,"hasMoved":true},null,null,null],[{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"white","gameTurnNumber":14,"plyCount":26,"spells":{"white":{"jump":1,"freeze":5,"jumpLastUsedTurn":12,"freezeLastUsedTurn":0},"black":{"jump":0,"freeze":5,"jumpLastUsedTurn":13,"freezeLastUsedTurn":0}},"activeSpells":[{"type":"jump","targetId":"piece-6-4-1751772337326","expiresAtPly":27}],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":false,"q":false}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":25},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,null,{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,null,null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,null,null,null,null,null,null,null],[{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"black","gameTurnNumber":14,"plyCount":27,"spells":{"white":{"jump":1,"freeze":5,"jumpLastUsedTurn":12,"freezeLastUsedTurn":0},"black":{"jump":0,"freeze":5,"jumpLastUsedTurn":13,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":false,"q":false}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":26},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,null,{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"p","color":"black","id":"piece-1-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[null,null,null,null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,null,null,null,null,null,null,null],[{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}]],"currentPlayer":"white","gameTurnNumber":15,"plyCount":28,"spells":{"white":{"jump":1,"freeze":5,"jumpLastUsedTurn":12,"freezeLastUsedTurn":0},"black":{"jump":0,"freeze":5,"jumpLastUsedTurn":13,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":true,"Q":true},"black":{"k":false,"q":false}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":27},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,null,{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true}],[null,null,null,null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,null,null,null,null,null,null,null],[{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":true,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null]],"currentPlayer":"black","gameTurnNumber":15,"plyCount":29,"spells":{"white":{"jump":0,"freeze":5,"jumpLastUsedTurn":15,"freezeLastUsedTurn":0},"black":{"jump":0,"freeze":5,"jumpLastUsedTurn":13,"freezeLastUsedTurn":0}},"activeSpells":[{"type":"jump","targetId":"piece-6-7-1751772337326","expiresAtPly":30}],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":false,"Q":true},"black":{"k":false,"q":false}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":28},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,null,null,{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true}],[null,null,{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,null,null,null,null,null,null,null],[{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null]],"currentPlayer":"white","gameTurnNumber":16,"plyCount":30,"spells":{"white":{"jump":0,"freeze":5,"jumpLastUsedTurn":15,"freezeLastUsedTurn":0},"black":{"jump":0,"freeze":5,"jumpLastUsedTurn":13,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":false,"Q":true},"black":{"k":false,"q":false}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":29},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,null,null,{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null],[null,null,{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true}],[null,null,null,null,null,null,null,null],[{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null]],"currentPlayer":"black","gameTurnNumber":16,"plyCount":31,"spells":{"white":{"jump":0,"freeze":5,"jumpLastUsedTurn":15,"freezeLastUsedTurn":0},"black":{"jump":0,"freeze":5,"jumpLastUsedTurn":13,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":false,"Q":true},"black":{"k":false,"q":false}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":30},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null],[null,null,{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true}],[null,null,null,null,null,null,null,null],[{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null]],"currentPlayer":"white","gameTurnNumber":17,"plyCount":32,"spells":{"white":{"jump":0,"freeze":5,"jumpLastUsedTurn":15,"freezeLastUsedTurn":0},"black":{"jump":0,"freeze":5,"jumpLastUsedTurn":13,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":false,"Q":true},"black":{"k":false,"q":false}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":31},{"board":[[{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null],[null,null,{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true}],[null,null,null,null,null,null,null,null],[{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null]],"currentPlayer":"black","gameTurnNumber":17,"plyCount":33,"spells":{"white":{"jump":0,"freeze":5,"jumpLastUsedTurn":15,"freezeLastUsedTurn":0},"black":{"jump":0,"freeze":5,"jumpLastUsedTurn":13,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":false,"Q":true},"black":{"k":false,"q":false}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":32},{"board":[[null,null,{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null],[null,null,{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true}],[null,null,null,null,null,null,null,null],[{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null]],"currentPlayer":"white","gameTurnNumber":18,"plyCount":34,"spells":{"white":{"jump":0,"freeze":5,"jumpLastUsedTurn":15,"freezeLastUsedTurn":0},"black":{"jump":0,"freeze":5,"jumpLastUsedTurn":13,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":false,"Q":true},"black":{"k":false,"q":false}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":33},{"board":[[null,null,{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null],[null,null,{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true}],[null,null,null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null],[{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null]],"currentPlayer":"black","gameTurnNumber":18,"plyCount":35,"spells":{"white":{"jump":0,"freeze":5,"jumpLastUsedTurn":15,"freezeLastUsedTurn":0},"black":{"jump":0,"freeze":5,"jumpLastUsedTurn":13,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":{"r":5,"c":5},"castlingRights":{"white":{"K":false,"Q":true},"black":{"k":false,"q":false}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":34},{"board":[[null,null,{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null],[null,{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true}],[null,null,null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null],[{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null]],"currentPlayer":"white","gameTurnNumber":19,"plyCount":36,"spells":{"white":{"jump":0,"freeze":5,"jumpLastUsedTurn":15,"freezeLastUsedTurn":0},"black":{"jump":0,"freeze":5,"jumpLastUsedTurn":13,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":false,"Q":true},"black":{"k":false,"q":false}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":35},{"board":[[null,null,{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null],[null,{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true}],[null,null,null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null],[{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null]],"currentPlayer":"black","gameTurnNumber":19,"plyCount":37,"spells":{"white":{"jump":0,"freeze":5,"jumpLastUsedTurn":15,"freezeLastUsedTurn":0},"black":{"jump":0,"freeze":5,"jumpLastUsedTurn":13,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":false,"Q":true},"black":{"k":false,"q":false}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":36},{"board":[[null,null,{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null],[null,{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true}],[null,null,null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null],[{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null]],"currentPlayer":"white","gameTurnNumber":20,"plyCount":38,"spells":{"white":{"jump":0,"freeze":5,"jumpLastUsedTurn":15,"freezeLastUsedTurn":0},"black":{"jump":0,"freeze":5,"jumpLastUsedTurn":13,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":false,"Q":true},"black":{"k":false,"q":false}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":37},{"board":[[null,null,{"type":"r","color":"black","id":"piece-0-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"k","color":"black","id":"piece-0-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"r","color":"black","id":"piece-0-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null],[{"type":"p","color":"black","id":"piece-1-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"p","color":"black","id":"piece-1-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,{"type":"p","color":"black","id":"piece-1-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null],[null,{"type":"n","color":"black","id":"piece-0-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"n","color":"black","id":"piece-0-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"p","color":"black","id":"piece-1-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"R","color":"white","id":"piece-7-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true}],[null,{"type":"p","color":"black","id":"piece-1-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"P","color":"white","id":"piece-6-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,null],[null,null,null,null,null,{"type":"P","color":"white","id":"piece-6-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null],[{"type":"P","color":"white","id":"piece-6-1-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"B","color":"white","id":"piece-7-5-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"P","color":"white","id":"piece-6-3-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,{"type":"b","color":"black","id":"piece-0-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null],[{"type":"P","color":"white","id":"piece-6-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,{"type":"B","color":"white","id":"piece-7-2-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},{"type":"N","color":"white","id":"piece-7-6-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":true},null,null,{"type":"P","color":"white","id":"piece-6-7-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false}],[{"type":"R","color":"white","id":"piece-7-0-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null,{"type":"K","color":"white","id":"piece-7-4-1751772337326","isFrozen":false,"isJumpable":false,"hasMoved":false},null,null,null]],"currentPlayer":"black","gameTurnNumber":20,"plyCount":39,"spells":{"white":{"jump":0,"freeze":5,"jumpLastUsedTurn":15,"freezeLastUsedTurn":0},"black":{"jump":0,"freeze":5,"jumpLastUsedTurn":13,"freezeLastUsedTurn":0}},"activeSpells":[],"selectedPiece":null,"spellMode":null,"spellCaster":null,"spellActivationState":null,"pendingSpellNotation":null,"enPassantTarget":null,"castlingRights":{"white":{"K":false,"Q":true},"black":{"k":false,"q":false}},"isGameOver":false,"gameEndMessage":"","awaitingPromotion":null,"useStandardPieces":false,"currentHistoryViewIndex":38}],"useStandardPieces":false,"currentHistoryViewIndex":39,"repetitionCounter":{"rnbqkbnr/pppppppp/        /        /        /        /PPPPPPPP/RNBQKBNR|white|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":true,\"q\":true}}|null|0,0,0,0":1,"rnbqkbnr/pppppppp/        /        /    P   /        /PPPP PPP/RNBQKBNR|black|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":true,\"q\":true}}|{\"r\":5,\"c\":4}|0,0,0,0":1,"rnbqkbnr/pp ppppp/  p     /        /    P   /        /PPPP PPP/RNBQKBNR|white|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":true,\"q\":true}}|null|0,0,0,0":1,"rnbqkbnr/pp ppppp/  p     /        /  B P   /        /PPPP PPP/RNBQK NR|black|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":true,\"q\":true}}|null|0,0,0,0":1,"rnbqkbnr/pp p ppp/  p p   /        /  B P   /        /PPPP PPP/RNBQK NR|white|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":true,\"q\":true}}|null|0,0,0,0":1,"rnbqkbnr/pp p ppp/  p p   /        /  B P   /  P     /PP P PPP/RNBQK NR|black|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":true,\"q\":true}}|null|0,0,0,0":1,"rnbqkbnr/p  p ppp/  p p   / p      /  B P   /  P     /PP P PPP/RNBQK NR|white|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":true,\"q\":true}}|{\"r\":2,\"c\":1}|0,0,0,0":1,"rnbqkbnr/p  p ppp/  p p   / p      /    P   / BP     /PP P PPP/RNBQK NR|black|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":true,\"q\":true}}|null|0,0,0,0":1,"rnbqkbnr/p  p ppp/    p   / pp     /    P   / BP     /PP P PPP/RNBQK NR|white|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":true,\"q\":true}}|null|0,0,0,0":1,"rnbqkbnr/p  p ppp/    p   / pp     /    P   / BP  Q  /PP P PPP/RNB K NR|black|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":true,\"q\":true}}|null|0,0,0,0":1,"rnb kbnr/p  pqppp/    p   / pp     /    P   / BP  Q  /PP P PPP/RNB K NR|white|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":true,\"q\":true}}|null|0,0,0,0":1,"rnb kbnr/p  pqppp/    p   / pp     /    P   / BPP Q  /PP   PPP/RNB K NR|black|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":true,\"q\":true}}|null|0,0,0,0":1,"rn  kbnr/pb pqppp/    p   / pp     /    P   / BPP Q  /PP   PPP/RNB K NR|white|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":true,\"q\":true}}|null|0,0,0,0":1,"rn  kbnr/pb pqppp/    p   / pp     /    P   / BPP  Q /PP   PPP/RNB K NR|black|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":true,\"q\":true}}|null|0,0,0,0":1,"rn  kbnr/pb pqppp/    p   / p      /  p P   / BPP  Q /PP   PPP/RNB K NR|white|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":true,\"q\":true}}|null|0,0,0,0":1,"rn  kbnr/pb pqppp/    p   / p      /  p P   /NBPP  Q /PP   PPP/R B K NR|black|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":true,\"q\":true}}|null|0,0,0,0":1,"rn  kbnr/p  pqppp/  b p   / p      /  p P   /NBPP  Q /PP   PPP/R B K NR|white|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":true,\"q\":true}}|null|0,0,0,0":1,"rn  kbnr/p  pqppp/  b p   / p      /  B P   /N PP  Q /PP   PPP/R B K NR|black|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":true,\"q\":true}}|null|0,0,0,0":1,"rn  k nr/p  pq*ppp/  b p   / p      /  B P   /b PP  Q /PP   PPP/R B K NR|white|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":true,\"q\":true}}|null|0,0,9,0":1,"rn  k nr/p  pqppp/  b p   / p      /  B P   /P PP  Q /P    PPP/R B K NR|black|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":true,\"q\":true}}|null|0,0,9,0":1,"rn  k  r/p  pqppp/  b pn  / p      /  B P   /P PP  Q /P    PPP/R B K NR|white|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":true,\"q\":true}}|null|0,0,9,0":1,"rn  k  r/p  pqpQp/  b pn  / p      /  B P   /P PP    /P    PPP/R B K NR|black|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":true,\"q\":true}}|null|0,0,9,0":1,"rn  k r /p  pqpQp/  b pn  / p      /  B P   /P PP    /P    PPP/R B K NR|white|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":false,\"q\":true}}|null|0,0,9,0":1,"rn  k r /p  pQp* p/  b pn  / p      /  B P   /P PP    /P    PPP/R B K NR|black|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":false,\"q\":true}}|null|12,0,9,0":1,"rn    r /p  pkp p/  b pn  / p      /  B P   /P PP    /P    PPP/R B K NR|white|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":false,\"q\":false}}|null|12,0,9,0":1,"rn    r /p  pkp p/  b pn  / p      /    P   /PBPP    /P    PPP/R B K NR|black|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":false,\"q\":false}}|null|12,0,9,0":1,"rn    r /p  pkp p/    pn  / p      /    P*   /PBPP    /P    PbP/R B K NR|white|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":false,\"q\":false}}|null|12,0,13,0":1,"rn    r /p  pkp p/    pn  / p  P   /        /PBPP    /P    PbP/R B K NR|black|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":false,\"q\":false}}|null|12,0,13,0":1,"rn    r /p  pkp p/    p   / p nP   /        /PBPP    /P    PbP/R B K NR|white|{\"white\":{\"K\":true,\"Q\":true},\"black\":{\"k\":false,\"q\":false}}|null|12,0,13,0":1,"rn    r /p  pkp R/    p   / p nP   /        /PBPP    /P    PbP*/R B K N |black|{\"white\":{\"K\":false,\"Q\":true},\"black\":{\"k\":false,\"q\":false}}|null|15,0,13,0":1,"r     r /p  pkp R/  n p   / p nP   /        /PBPP    /P    PbP/R B K N |white|{\"white\":{\"K\":false,\"Q\":true},\"black\":{\"k\":false,\"q\":false}}|null|15,0,13,0":1,"r     r /p  pkp  /  n p   / p nP  R/        /PBPP    /P    PbP/R B K N |black|{\"white\":{\"K\":false,\"Q\":true},\"black\":{\"k\":false,\"q\":false}}|null|15,0,13,0":1,"r   k r /p  p p  /  n p   / p nP  R/        /PBPP    /P    PbP/R B K N |white|{\"white\":{\"K\":false,\"Q\":true},\"black\":{\"k\":false,\"q\":false}}|null|15,0,13,0":1,"r   k r /p  p p  /  n p   / p nP  R/        /PBPP    /P  B PbP/R   K N |black|{\"white\":{\"K\":false,\"Q\":true},\"black\":{\"k\":false,\"q\":false}}|null|15,0,13,0":1,"  r k r /p  p p  /  n p   / p nP  R/        /PBPP    /P  B PbP/R   K N |white|{\"white\":{\"K\":false,\"Q\":true},\"black\":{\"k\":false,\"q\":false}}|null|15,0,13,0":1,"  r k r /p  p p  /  n p   / p nP  R/     P  /PBPP    /P  B  bP/R   K N |white|{\"white\":{\"K\":false,\"Q\":true},\"black\":{\"k\":false,\"q\":false}}|null|15,0,13,0":1,"  r k r /p  p p  / nn p   / p  P  R/     P  /PBPP    /P  B  bP/R   K N |black|{\"white\":{\"K\":false,\"Q\":true},\"black\":{\"k\":false,\"q\":false}}|{\"r\":5,\"c\":5}|15,0,13,0":1,"  r k r /p  p p  / nn p   / p  P  R/     P  /PBPP    /P  BN bP/R   K   |white|{\"white\":{\"K\":false,\"Q\":true},\"black\":{\"k\":false,\"q\":false}}|null|15,0,13,0":1,"  r k r /p  p p  / nn p   / p  P  R/     P  /PBPP b  /P  BN  P/R   K   |black|{\"white\":{\"K\":false,\"Q\":true},\"black\":{\"k\":false,\"q\":false}}|null|15,0,13,0":1,"  r k r /p  p p  / nn p  R/ p  P   /     P  /PBPP b  /P  BN  P/R   K   |white|{\"white\":{\"K\":false,\"Q\":true},\"black\":{\"k\":false,\"q\":false}}|null|15,0,13,0":1}}</script>

    <script id="home-page-script">
        const startGameButton = document.getElementById('start-game-button');
        const goHomeMenuItem = document.getElementById('go-home-menu-item');
        
        function goHome() {
            if(typeof gameState !== 'undefined' && gameState) {
                const serializedState = JSON.stringify(gameState);
                localStorage.setItem('savedSpellChessGame', serializedState);
            }
            document.body.classList.remove('game-view');
            document.body.classList.add('home-view');
        }

        goHomeMenuItem.addEventListener('click', goHome);

        startGameButton.addEventListener('click', function() {
            document.body.classList.remove('home-view');
            document.body.classList.add('game-view');
            
            const savedGame = localStorage.getItem('savedSpellChessGame');
            if (savedGame) {
                if (typeof resetGame === 'function') {
                    // This data will be picked up by the main script's resetGame function
                    initialGameDataFromSave = JSON.parse(savedGame);
                    resetGame(false);
                }
            } else {
                 if (typeof resetGame === 'function') { 
                    resetGame(true);
                }
            }
        });
    </script>

    <script id="spell-chess-game-script">
        const PIECES = {
            'P': '♙', 'R': '♖', 'N': '♘', 'B': '♗', 'Q': '♕', 'K': '♔',
            'p': '♟', 'r': '♜', 'n': '♞', 'b': '♝', 'q': '♛', 'k': '♚'
        };
        let useStandardPieces = false; 
        let isBoardFlipped = false;

        const initialBoardSetup = [
            ['r', 'n', 'b', 'q', 'k', 'b', 'n', 'r'],
            ['p', 'p', 'p', 'p', 'p', 'p', 'p', 'p'],
            [null, null, null, null, null, null, null, null],
            [null, null, null, null, null, null, null, null],
            [null, null, null, null, null, null, null, null],
            [null, null, null, null, null, null, null, null],
            ['P', 'P', 'P', 'P', 'P', 'P', 'P', 'P'],
            ['R', 'N', 'B', 'Q', 'K', 'B', 'N', 'R']
        ];

        let gameState;
        let initialGameDataFromSave = null;
        let statusTimeout; // For temporary status messages

        const chessboardDiv = document.getElementById('chessboard');
        const controlsDiv = document.querySelector('.controls');
        const statusArea = document.getElementById('status-area');
        const notationArea = document.getElementById('notation-area');
        const cancelButton = document.getElementById('cancel-button'); 
        const promotionChoicesDiv = document.getElementById('promotion-choices');
        
        const historyBackButtons = [document.getElementById('history-back-button-desktop'), document.getElementById('history-back-button-mobile')];
        const historyForwardButtons = [document.getElementById('history-forward-button-desktop'), document.getElementById('history-forward-button-mobile')];
        const copyNotationButtons = [document.getElementById('copy-notation-button-desktop'), document.getElementById('copy-notation-button-mobile')];
        
        const importGameArea = document.getElementById('import-game-area');
        const loadGameButton = document.getElementById('load-game-button');
        const cancelImportButton = document.getElementById('cancel-import-button');
        const importGameTextarea = document.getElementById('import-game-textarea');
        
        // --- Drawing Variables ---
        let arrowCanvas, arrowCtx;
        let drawnArrows = [];
        let drawnRings = [];
        let arrowStartSquare = null;

        const DRAWING_COLORS = {
            green: 'rgba(0, 128, 0, 0.7)',
            red: 'rgba(255, 0, 0, 0.7)',
            yellow: 'rgba(255, 255, 0, 0.7)'
        };

        function deepCopyGameStateForSnapshot(sourceState) { 
            if (!sourceState) return null;
            const target = {};
            for (const key in sourceState) {
                if (Object.prototype.hasOwnProperty.call(sourceState, key)) {
                    if (key === 'history' || key === 'moveLog' || key === 'repetitionCounter') { 
                        continue; 
                    }
                    const value = sourceState[key];
                    if (typeof value === 'object' && value !== null) {
                        target[key] = JSON.parse(JSON.stringify(value));
                    } else {
                        target[key] = value;
                    }
                }
            }
            return target;
        }
        
        function deepCopyFullState(sourceState) {
            return JSON.parse(JSON.stringify(sourceState));
        }

        function initializeGameState() {
            gameState = {
                board: [],
                currentPlayer: 'white',
                gameTurnNumber: 1,
                plyCount: 0, 
                spells: {
                    white: { jump: 2, freeze: 5, jumpLastUsedTurn: 0, freezeLastUsedTurn: 0 },
                    black: { jump: 2, freeze: 5, jumpLastUsedTurn: 0, freezeLastUsedTurn: 0 }
                },
                activeSpells: [],
                selectedPiece: null,
                spellMode: null,
                spellCaster: null,
                spellActivationState: null,
                pendingSpellNotation: null,
                moveLog: [], 
                enPassantTarget: null,
                castlingRights: {
                    white: { K: true, Q: true },
                    black: { k: true, q: true }
                },
                isGameOver: false,
                gameEndMessage: "", 
                awaitingPromotion: null,
                history: [],
                useStandardPieces: false,
                currentHistoryViewIndex: 0,
                repetitionCounter: {}
            };
        }

        function initializeBoardState() {
            gameState.board = initialBoardSetup.map((row, r) =>
                row.map((pieceType, c) => {
                    if (!pieceType) return null;
                    const color = (pieceType === pieceType.toUpperCase()) ? 'white' : 'black';
                    return {
                        type: pieceType,
                        color: color,
                        id: `piece-${r}-${c}-${Date.now()}`, 
                        isFrozen: false,
                        isJumpable: false,
                        hasMoved: false
                    };
                })
            );
        }

        function resetGame(forceNewGame = false) {
            isBoardFlipped = false;
            applyBoardFlip();
            drawnArrows = [];
            drawnRings = [];
            if (arrowCtx) drawAllDrawings();
            
            // This is now the primary load path for saved games via the home screen.
            if (!forceNewGame && initialGameDataFromSave) {
                gameState = deepCopyFullState(initialGameDataFromSave); 
                useStandardPieces = gameState.useStandardPieces === undefined ? false : gameState.useStandardPieces; 
                if (gameState.currentHistoryViewIndex === undefined) {
                    gameState.currentHistoryViewIndex = gameState.history.length - 1;
                }
                if (gameState.repetitionCounter === undefined) {
                    gameState.repetitionCounter = {};
                }
                initialGameDataFromSave = null; 
                console.log("Game loaded from saved state.");
                document.body.classList.remove('home-view');
                document.body.classList.add('game-view');
                loadStateFromHistory(gameState.currentHistoryViewIndex, true);
            } else {
                initializeGameState();
                initializeBoardState();
                const initialSnapshot = deepCopyGameStateForSnapshot(gameState); 
                gameState.history.push(initialSnapshot);
                const signature = generateStateSignature(initialSnapshot);
                gameState.repetitionCounter[signature] = 1;
                gameState.currentHistoryViewIndex = 0;
                console.log("New game started.");
                loadStateFromHistory(0, true);
            }
        }
        
        function applyPieceStyle() {
            const togglePiecesText = document.querySelector('#toggle-pieces-menu-item .menu-item-text');
            if (useStandardPieces) {
                chessboardDiv.classList.remove('colored-pieces');
                togglePiecesText.textContent = "Use Colored Pieces";
            } else {
                chessboardDiv.classList.add('colored-pieces');
                togglePiecesText.textContent = "Use Standard Pieces";
            }
            if(gameState && gameState.board && gameState.board.length > 0) { 
               renderBoard();
            }
        }

        function applyBoardFlip() {
            chessboardDiv.classList.toggle('flipped', isBoardFlipped);
            controlsDiv.classList.toggle('flipped', isBoardFlipped);
            drawAllDrawings();
        }

        function handleFlipBoard() {
            isBoardFlipped = !isBoardFlipped;
            applyBoardFlip();
        }

        // --- Drawing Functions ---
        function getCoordsFromEvent(event) {
            const square = event.target.closest('.square');
            if (!square) return null;
            const r = parseInt(square.dataset.r, 10);
            const c = parseInt(square.dataset.c, 10);
            return { r, c };
        }

        function handleMouseDownForDrawing(event) {
            if (event.button !== 2) return; // Only for right-click
            event.preventDefault();
            const coords = getCoordsFromEvent(event);
            if (!coords) return;
            
            let color = DRAWING_COLORS.green;
            if (event.shiftKey) {
                color = DRAWING_COLORS.red;
            } else if (event.ctrlKey || event.metaKey) {
                color = DRAWING_COLORS.yellow;
            }
            
            arrowStartSquare = { r: coords.r, c: coords.c, color: color };
        }

        function handleMouseUpForDrawing(event) {
            if (event.button !== 2 || !arrowStartSquare) return;
            event.preventDefault();
            const endSquare = getCoordsFromEvent(event);

            if (!endSquare) {
                arrowStartSquare = null;
                return;
            }

            // It's a click on a single square (for a ring)
            if (endSquare.r === arrowStartSquare.r && endSquare.c === arrowStartSquare.c) {
                const newRing = { r: arrowStartSquare.r, c: arrowStartSquare.c, color: arrowStartSquare.color };
                
                // Find index of any ring on the same square, regardless of color
                const existingIndex = drawnRings.findIndex(ring =>
                    ring.r === newRing.r && ring.c === newRing.c
                );

                if (existingIndex > -1) {
                    const existingRing = drawnRings[existingIndex];
                    // Remove the old ring
                    drawnRings.splice(existingIndex, 1);
                    // If the new ring has a different color, add it back.
                    // If it's the same color, the net effect is just removal.
                    if (existingRing.color !== newRing.color) {
                        drawnRings.push(newRing);
                    }
                } else {
                    // No ring was there, so just add the new one.
                    drawnRings.push(newRing);
                }
            } 
            // It's a drag between squares (for an arrow)
            else {
                const newArrow = { 
                    from: { r: arrowStartSquare.r, c: arrowStartSquare.c }, 
                    to: endSquare,
                    color: arrowStartSquare.color
                };

                // Find index of any arrow with same from/to, regardless of color
                const existingIndex = drawnArrows.findIndex(arrow =>
                    arrow.from.r === newArrow.from.r && arrow.from.c === newArrow.from.c &&
                    arrow.to.r === newArrow.to.r && arrow.to.c === newArrow.to.c
                );

                if (existingIndex > -1) {
                    const existingArrow = drawnArrows[existingIndex];
                    // Remove the old arrow
                    drawnArrows.splice(existingIndex, 1);
                    // If the new arrow has a different color, add it.
                    // If it's the same color, the net effect is removal.
                    if (existingArrow.color !== newArrow.color) {
                        drawnArrows.push(newArrow);
                    }
                } else {
                    // No arrow was there, so just add the new one.
                    drawnArrows.push(newArrow);
                }
            }
            
            drawAllDrawings();
            arrowStartSquare = null;
        }
        
        function drawAllDrawings() {
            if (!arrowCtx || !arrowCanvas) return;
            // Fix canvas buffer size to prevent stretching distortion.
            arrowCanvas.width = chessboardDiv.offsetWidth;
            arrowCanvas.height = chessboardDiv.offsetHeight;
            
            arrowCtx.clearRect(0, 0, arrowCanvas.width, arrowCanvas.height);

            // Calculate correct grid geometry, accounting for the border.
            const chessboardStyle = window.getComputedStyle(chessboardDiv);
            const borderOffset = parseFloat(chessboardStyle.borderLeftWidth) || 0;
            const actualSquareSize = chessboardDiv.clientWidth / 8;

            for (const ring of drawnRings) {
                let r = ring.r;
                let c = ring.c;
                 if (isBoardFlipped) {
                    r = 7 - r;
                    c = 7 - c;
                }
                const centerX = borderOffset + (c + 0.5) * actualSquareSize;
                const centerY = borderOffset + (r + 0.5) * actualSquareSize;
                drawRingOnCanvas(arrowCtx, centerX, centerY, actualSquareSize, ring.color);
            }

            for (const arrow of drawnArrows) {
                let fromR = arrow.from.r;
                let fromC = arrow.from.c;
                let toR = arrow.to.r;
                let toC = arrow.to.c;

                if (isBoardFlipped) {
                    fromR = 7 - fromR;
                    fromC = 7 - fromC;
                    toR = 7 - toR;
                    toC = 7 - toC;
                }
                
                // Calculate arrow coordinates using correct grid geometry
                const fromX = borderOffset + (fromC + 0.5) * actualSquareSize;
                const fromY = borderOffset + (fromR + 0.5) * actualSquareSize;
                const toX = borderOffset + (toC + 0.5) * actualSquareSize;
                const toY = borderOffset + (toR + 0.5) * actualSquareSize;

                drawArrowOnCanvas(arrowCtx, fromX, fromY, toX, toY, actualSquareSize, arrow.color);
            }
        }

        function drawRingOnCanvas(ctx, centerX, centerY, squareSize, color) {
            const lineWidth = Math.max(4.5, squareSize * 0.12);
            const radius = ((squareSize / 2) - (lineWidth / 2)) * 0.9;
            ctx.save();
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
            ctx.strokeStyle = color;
            ctx.lineWidth = lineWidth;
            ctx.stroke();
            ctx.restore();
        }
        function drawArrowOnCanvas(ctx, fromX, fromY, toX, toY, squareSize, color) {
            const headSideLength = 22.5; 
            const shaftWidth = Math.max(4.5, squareSize * 0.12);
            
            const angle = Math.atan2(toY - fromY, toX - fromX);
            const orthoAngle = angle + Math.PI / 2;

            const headAngle = Math.PI / 6;
            const headLength = headSideLength * Math.cos(headAngle);
            const headHalfWidth = headSideLength * Math.sin(headAngle);

            const startOffset = squareSize * 0.20;
            const endOffset = squareSize * 0.35;

            const startPoint = {
                x: fromX + startOffset * Math.cos(angle),
                y: fromY + startOffset * Math.sin(angle)
            };
            const tipPoint = {
                x: toX - endOffset * Math.cos(angle),
                y: toY - endOffset * Math.sin(angle)
            };
            const headBasePoint = {
                x: tipPoint.x - headLength * Math.cos(angle),
                y: tipPoint.y - headLength * Math.sin(angle)
            };
            
            if (shaftWidth >= headHalfWidth * 2) {
                 const vertices = [
                    tipPoint,
                    { x: startPoint.x + (shaftWidth / 2) * Math.cos(orthoAngle), y: startPoint.y + (shaftWidth / 2) * Math.sin(orthoAngle) },
                    { x: startPoint.x - (shaftWidth / 2) * Math.cos(orthoAngle), y: startPoint.y - (shaftWidth / 2) * Math.sin(orthoAngle) }
                ];
                ctx.save();
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.moveTo(vertices[0].x, vertices[0].y);
                ctx.lineTo(vertices[1].x, vertices[1].y);
                ctx.lineTo(vertices[2].x, vertices[2].y);
                ctx.closePath();
                ctx.fill();
                ctx.restore();
                return;
            }
            
            const halfShaft = shaftWidth / 2;
            const vertices = [
                tipPoint,
                { x: headBasePoint.x + headHalfWidth * Math.cos(orthoAngle), y: headBasePoint.y + headHalfWidth * Math.sin(orthoAngle) },
                { x: headBasePoint.x + halfShaft * Math.cos(orthoAngle), y: headBasePoint.y + halfShaft * Math.sin(orthoAngle) },
                { x: startPoint.x + halfShaft * Math.cos(orthoAngle), y: startPoint.y + halfShaft * Math.sin(orthoAngle) },
                { x: startPoint.x - halfShaft * Math.cos(orthoAngle), y: startPoint.y - halfShaft * Math.sin(orthoAngle) },
                { x: headBasePoint.x - halfShaft * Math.cos(orthoAngle), y: headBasePoint.y - halfShaft * Math.sin(orthoAngle) },
                { x: headBasePoint.x - headHalfWidth * Math.cos(orthoAngle), y: headBasePoint.y - headHalfWidth * Math.sin(orthoAngle) }
            ];

            ctx.save();
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.moveTo(vertices[0].x, vertices[0].y);
            for (let i = 1; i < vertices.length; i++) {
                ctx.lineTo(vertices[i].x, vertices[i].y);
            }
            ctx.closePath();
            ctx.fill();
            ctx.restore();
        }

        // --- Event Listeners ---
        document.getElementById('toggle-pieces-menu-item').addEventListener('click', () => {
            useStandardPieces = !useStandardPieces;
            gameState.useStandardPieces = useStandardPieces; 
            applyPieceStyle();
        });

        document.getElementById('reset-game-menu-item').addEventListener('click', () => {
            if (confirm("Are you sure? All game data will be lost.")) {
                localStorage.removeItem('savedSpellChessGame');
                resetGame(true);
            }
        });

        document.getElementById('get-link-menu-item').addEventListener('click', () => {
            const baseURL = 'https://wjkiely.github.io/spell-chess/current.html';
            if (gameState.moveLog.length === 0) {
                showTemporaryStatus("No moves to create a link from.");
                return;
            }
            const compactString = gameState.moveLog.flatMap(log => log.actions).join(',');
            const encodedData = encodeURIComponent(btoa(compactString));
            const finalURL = `${baseURL}?game=${encodedData}`;

            navigator.clipboard.writeText(finalURL).then(() => {
                showTemporaryStatus("Custom game link copied to clipboard!");
            }).catch(err => {
                console.error('Failed to copy link: ', err);
                showTemporaryStatus("Failed to copy link. See console.");
            });
        });

        document.getElementById('download-game-menu-item').addEventListener('click', () => { 
            // Close any open menus first so they are not saved in the open state.
            document.getElementById('main-menu').classList.remove('show');
            document.getElementById('settings-menu').classList.remove('show');

            if (gameState.awaitingPromotion) {
                showTemporaryStatus("Cannot download game while awaiting pawn promotion.");
                return;
            }
            const stateToSave = deepCopyFullState(gameState);
            stateToSave.currentHistoryViewIndex = stateToSave.history.length - 1;
            loadStateFromHistory(stateToSave.currentHistoryViewIndex, false); 
            stateToSave.useStandardPieces = useStandardPieces; 
            
            const serializedState = JSON.stringify(stateToSave);

            const clonedDocument = document.cloneNode(true);
            
            let existingSavedScriptInClone = clonedDocument.getElementById('savedGameStateData');
            if (existingSavedScriptInClone) {
                existingSavedScriptInClone.textContent = serializedState; 
            } else { 
                const scriptTag = clonedDocument.createElement('script');
                scriptTag.id = 'savedGameStateData';
                scriptTag.type = 'application/json'; 
                scriptTag.textContent = serializedState;
                clonedDocument.head.appendChild(scriptTag);
            }

            const fullHtmlContent = '<!DOCTYPE html>\n' + clonedDocument.documentElement.outerHTML;
            const blob = new Blob([fullHtmlContent], { type: 'text/html;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            
            let filename = "Spell_chess.html"; 
            if (stateToSave.moveLog.length > 0) {
                const lastFullTurnEntryIndex = stateToSave.moveLog.length - 1;
                let turnNumberForFile = stateToSave.moveLog[lastFullTurnEntryIndex].turn;
                let whiteMoveForFile = "";
                let blackMoveForFile = "";

                for(let i = lastFullTurnEntryIndex; i >=0; i--){
                    if(stateToSave.moveLog[i].turn === turnNumberForFile && stateToSave.moveLog[i].player === 'white'){
                        whiteMoveForFile = stateToSave.moveLog[i].notation.replace(/[#+=\s@]/g, '');
                        break;
                    }
                     if(stateToSave.moveLog[i].turn < turnNumberForFile) break;
                }
                for(let i = lastFullTurnEntryIndex; i >=0; i--){
                     if(stateToSave.moveLog[i].turn === turnNumberForFile && stateToSave.moveLog[i].player === 'black'){
                        blackMoveForFile = stateToSave.moveLog[i].notation.replace(/[#+=\s@]/g, '');
                        break;
                    }
                    if(stateToSave.moveLog[i].turn < turnNumberForFile) break;
                }
                
                filename = `${turnNumberForFile}`;
                if (whiteMoveForFile) {
                    filename += whiteMoveForFile;
                }
                if (blackMoveForFile) {
                     filename += (whiteMoveForFile ? "_" : "") + blackMoveForFile;
                }
                filename += ".html";
            }
            link.download = filename;

            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);

            loadStateFromHistory(gameState.currentHistoryViewIndex, true);
        });

        cancelButton.addEventListener('click', handleCancelAction); 
        historyBackButtons.forEach(btn => btn.addEventListener('click', handleHistoryBack));
        historyForwardButtons.forEach(btn => btn.addEventListener('click', handleHistoryForward));

        promotionChoicesDiv.addEventListener('click', function(event) {
            if (event.target.classList.contains('promotion-button') && gameState.awaitingPromotion) {
                const chosenPieceType = event.target.dataset.promote;
                const { r, c, color, originalMoveNotation, movingPiece, fromR, fromC } = gameState.awaitingPromotion;

                gameState.board[r][c].type = (color === 'white') ? chosenPieceType.toUpperCase() : chosenPieceType.toLowerCase();
                
                const finalMoveNotation = originalMoveNotation + "=" + chosenPieceType.toUpperCase(); 

                gameState.awaitingPromotion = null;
                promotionChoicesDiv.style.display = 'none';
                updateCancelButtonVisibility(); 
                
                renderBoard(); 
                endTurn(finalMoveNotation, movingPiece, fromR, r, fromC, c);
            }
        });

        function renderBoard() {
            chessboardDiv.innerHTML = '';
            if (!useStandardPieces) {
                chessboardDiv.classList.add('colored-pieces');
            } else {
                chessboardDiv.classList.remove('colored-pieces');
            }
            
            const validMovesForSelected = gameState.selectedPiece ? getValidMovesForPiece(gameState.selectedPiece.r, gameState.selectedPiece.c) : [];

            gameState.board.forEach((row, r_idx) => {
                row.forEach((piece, c_idx) => {
                    const square = document.createElement('div');
                    square.classList.add('square');
                    square.classList.add((r_idx + c_idx) % 2 === 0 ? 'light' : 'dark');
                    square.dataset.r = r_idx;
                    square.dataset.c = c_idx;

                    square.classList.remove('active-freeze-zone', 'jumpable-on-square',
                                            'freeze-outline-top', 'freeze-outline-bottom',
                                            'freeze-outline-left', 'freeze-outline-right');
                    
                    if (isSquareUnderActiveFreeze(r_idx, c_idx, gameState.activeSpells, gameState.plyCount)) {
                        square.classList.add('active-freeze-zone');
                        const freezeEmojiSpan = document.createElement('span');
                        freezeEmojiSpan.classList.add('square-freeze-emoji');
                        freezeEmojiSpan.textContent = '❄️';
                        square.appendChild(freezeEmojiSpan);
                    }
                    if (piece && piece.isJumpable) {
                        square.classList.add('jumpable-on-square');
                    }
                     gameState.activeSpells.forEach(spell => {
                        if (spell.type === 'freeze' && gameState.plyCount < spell.expiresAtPly) {
                            const spellCenterR = spell.targetSquare.r;
                            const spellCenterC = spell.targetSquare.c;
                            const minEffectR = Math.max(0, spellCenterR - 1);
                            const maxEffectR = Math.min(7, spellCenterR + 1);
                            const minEffectC = Math.max(0, spellCenterC - 1);
                            const maxEffectC = Math.min(7, spellCenterC + 1);
                            if (r_idx >= minEffectR && r_idx <= maxEffectR && c_idx >= minEffectC && c_idx <= maxEffectC) {
                                if (r_idx === minEffectR) square.classList.add('freeze-outline-top');
                                if (r_idx === maxEffectR) square.classList.add('freeze-outline-bottom');
                                if (c_idx === minEffectC) square.classList.add('freeze-outline-left');
                                if (c_idx === maxEffectC) square.classList.add('freeze-outline-right');
                            }
                        }
                    });


                    if (piece) {
                        const pieceSpan = document.createElement('span');
                        pieceSpan.classList.add('piece');
                        
                        let displayPieceType = piece.type;
                        if (!useStandardPieces && piece.color === 'white') {
                            displayPieceType = piece.type.toLowerCase(); 
                            pieceSpan.classList.add('white-piece-alternative'); 
                        } else { 
                            pieceSpan.classList.remove('white-piece-alternative');
                        }

                        pieceSpan.textContent = PIECES[displayPieceType];
                        pieceSpan.dataset.pieceId = piece.id;
                        square.appendChild(pieceSpan);
                    }

                    if (gameState.selectedPiece && gameState.selectedPiece.r === r_idx && gameState.selectedPiece.c === c_idx) {
                        square.classList.add('selected');
                    }

                    if (validMovesForSelected.some(move => move.toR === r_idx && move.toC === c_idx)) {
                       square.classList.add('valid-move-hint');
                    }

                    square.addEventListener('click', () => onSquareClick(r_idx, c_idx));
                    chessboardDiv.appendChild(square);
                });
            });
            drawAllDrawings();
        }

        function isSquareUnderActiveFreeze(sqR, sqC, activeSpells, currentPly) {
            for (const spell of activeSpells) {
                if (spell.type === 'freeze' && currentPly < spell.expiresAtPly) {
                    const centerR = spell.targetSquare.r;
                    const centerC = spell.targetSquare.c;
                    if (Math.abs(sqR - centerR) <= 1 && Math.abs(sqC - centerC) <= 1) {
                        if (sqR >= Math.max(0, centerR -1) && sqR <= Math.min(7, centerR + 1) &&
                            sqC >= Math.max(0, centerC -1) && sqC <= Math.min(7, centerC + 1)) {
                            return true;
                        }
                    }
                }
            }
            return false;
        }

        function onSquareClick(r_clicked, c_clicked) {
            const isViewingLatest = gameState.currentHistoryViewIndex === gameState.history.length - 1;
            if (!isViewingLatest && !gameState.isGameOver) {
                updateStatus("You are viewing a past move. Click '>' to return to the present or make a new move to create a new game line.");
            }

            if (gameState.isGameOver || gameState.awaitingPromotion) { 
                if (gameState.awaitingPromotion) updateStatus("Choose promotion piece.");
                else if (!isViewingLatest) { /* allow clicks on board when game is over but not on latest move */ }
                else {
                    updateStatus("Game is over. Please reset to play again.");
                    return;
                }
            }

            const pieceAtClickedSquare = gameState.board[r_clicked][c_clicked];

            if (gameState.spellMode) {
                handleSpellTargeting(r_clicked, c_clicked);
                return;
            }

            if (gameState.selectedPiece) {
                if (gameState.selectedPiece.r === r_clicked && gameState.selectedPiece.c === c_clicked) {
                    gameState.selectedPiece = null;
                    renderBoard();
                    updateCancelButtonVisibility(); 
                    return;
                }

                const { r: fromR, c: fromC, piece: movingPiece } = gameState.selectedPiece;

                if (isValidMove(fromR, fromC, r_clicked, c_clicked, gameState.board, gameState.currentPlayer, gameState.enPassantTarget, gameState.castlingRights, gameState.activeSpells, gameState.plyCount)) {
                    let capturedPiece = gameState.board[r_clicked][c_clicked];
                    let moveNotation = generateMoveNotation(gameState, movingPiece, fromR, fromC, r_clicked, c_clicked, capturedPiece);
                    let isEnPassantCapture = false;
                    let isCastle = false;

                    if (movingPiece.type.toLowerCase() === 'k' && Math.abs(fromC - c_clicked) === 2) {
                        isCastle = true;
                        moveNotation = c_clicked > fromC ? "O-O" : "O-O-O";
                        
                        const rookFromC = c_clicked > fromC ? 7 : 0;
                        const rookToC = c_clicked > fromC ? c_clicked - 1 : c_clicked + 1;
                        const rook = gameState.board[fromR][rookFromC];
                        if (rook) {
                            gameState.board[fromR][rookToC] = rook;
                            gameState.board[fromR][rookFromC] = null;
                            rook.hasMoved = true;
                        }
                    } else if (movingPiece.type.toLowerCase() === 'p' &&
                        Math.abs(fromC - c_clicked) === 1 &&
                        !gameState.board[r_clicked][c_clicked] &&
                        gameState.enPassantTarget &&
                        r_clicked === gameState.enPassantTarget.r &&
                        c_clicked === gameState.enPassantTarget.c) {
                        isEnPassantCapture = true;
                        const epCapturedPawnActualR = fromR;
                        const epCapturedPawnActualC = c_clicked;
                        capturedPiece = gameState.board[epCapturedPawnActualR][epCapturedPawnActualC];
                        gameState.board[epCapturedPawnActualR][epCapturedPawnActualC] = null;
                        moveNotation = generateMoveNotation(gameState, movingPiece, fromR, fromC, r_clicked, c_clicked, capturedPiece, true);
                    }
                    
                    // General piece movement logic
                    gameState.board[r_clicked][c_clicked] = movingPiece;
                    gameState.board[fromR][fromC] = null;
                    movingPiece.hasMoved = true;

                    // Update castling rights
                    if (movingPiece.type.toLowerCase() === 'k') {
                        if (movingPiece.color === 'white') {
                            gameState.castlingRights.white.K = false;
                            gameState.castlingRights.white.Q = false;
                        } else {
                            gameState.castlingRights.black.k = false;
                            gameState.castlingRights.black.q = false;
                        }
                    } else if (movingPiece.type.toLowerCase() === 'r') {
                        if (movingPiece.color === 'white') {
                            if (fromR === 7 && fromC === 0) gameState.castlingRights.white.Q = false;
                            if (fromR === 7 && fromC === 7) gameState.castlingRights.white.K = false;
                        } else {
                            if (fromR === 0 && fromC === 0) gameState.castlingRights.black.q = false;
                            if (fromR === 0 && fromC === 7) gameState.castlingRights.black.k = false;
                        }
                    }

                    gameState.selectedPiece = null; 

                    if (!isCastle && movingPiece.type.toLowerCase() === 'p' &&
                        ((movingPiece.color === 'white' && r_clicked === 0) || (movingPiece.color === 'black' && r_clicked === 7))) {
                        
                        gameState.awaitingPromotion = {
                            r: r_clicked,
                            c: c_clicked,
                            color: movingPiece.color,
                            originalMoveNotation: moveNotation,
                            movingPiece: gameState.board[r_clicked][c_clicked], 
                            fromR: fromR, 
                            fromC: fromC  
                        };
                        promotionChoicesDiv.style.display = 'flex'; 
                        cancelButton.style.display = 'none'; 
                        updateStatus(`Choose promotion for pawn at ${String.fromCharCode(97 + c_clicked)}${8 - r_clicked}.`);
                        renderBoard(); 
                        return; 
                    }
                    
                    const pieceToEndTurnWith = gameState.board[r_clicked][c_clicked] || movingPiece; 
                    endTurn(moveNotation, pieceToEndTurnWith, fromR, r_clicked, fromC, c_clicked);
                } else if (pieceAtClickedSquare && pieceAtClickedSquare.color === gameState.currentPlayer) {
                    let effectivelyFrozenNewSelection = pieceAtClickedSquare.isFrozen || isSquareUnderActiveFreeze(r_clicked, c_clicked, gameState.activeSpells, gameState.plyCount);
                    if (effectivelyFrozenNewSelection) {
                        updateStatus("This piece is frozen or on a frozen square and cannot move.");
                        return; 
                    }
                    gameState.selectedPiece = { r: r_clicked, c: c_clicked, piece: pieceAtClickedSquare };
                    renderBoard();
                } else { 
                    updateStatus("Invalid move or empty square. Try again.");
                    gameState.selectedPiece = null; 
                    renderBoard();
                }
            } else { 
                if (pieceAtClickedSquare && pieceAtClickedSquare.color === gameState.currentPlayer) {
                    let effectivelyFrozenInitialSelection = pieceAtClickedSquare.isFrozen || isSquareUnderActiveFreeze(r_clicked, c_clicked, gameState.activeSpells, gameState.plyCount);
                    if (effectivelyFrozenInitialSelection) {
                        updateStatus("This piece is frozen or on a frozen square and cannot move.");
                        return;
                    }
                    gameState.selectedPiece = { r: r_clicked, c: c_clicked, piece: pieceAtClickedSquare };
                    renderBoard();
                }
            }
            updateCancelButtonVisibility(); 
        }

        function isPathClear(fromR, fromC, toR, toC, board) {
            const dr = Math.sign(toR - fromR);
            const dc = Math.sign(toC - fromC);
            let r = fromR + dr;
            let c = fromC + dc;

            while (r !== toR || c !== toC) {
                if (r < 0 || r >= 8 || c < 0 || c >= 8) return false; 
                const pieceOnPath = board[r][c];
                if (pieceOnPath && !pieceOnPath.isJumpable) { 
                    return false; 
                }
                r += dr;
                c += dc;
            }
            return true;
        }

        function isSquareAttacked(targetR, targetC, attackerColor, board, enPassantTarget, activeSpells, currentPly) {
            for (let r_attacker = 0; r_attacker < 8; r_attacker++) { 
                for (let c_attacker = 0; c_attacker < 8; c_attacker++) {
                    const piece = board[r_attacker][c_attacker];
                    if (piece && piece.color === attackerColor) {
                        let effectivelyFrozenAttacker = piece.isFrozen || isSquareUnderActiveFreeze(r_attacker, c_attacker, activeSpells, currentPly);
                        if (effectivelyFrozenAttacker && piece.type.toLowerCase() !== 'k') continue; 


                        const pieceType = piece.type.toLowerCase();
                        if (pieceType === 'p') {
                            const attackDR = (attackerColor === 'white') ? -1 : 1; 
                            if (r_attacker + attackDR === targetR && Math.abs(c_attacker - targetC) === 1) return true;
                        } else if (pieceType === 'n') {
                            const drAbs = Math.abs(targetR - r_attacker);
                            const dcAbs = Math.abs(targetC - c_attacker);
                            if ((drAbs === 2 && dcAbs === 1) || (drAbs === 1 && dcAbs === 2)) return true;
                        } else if (pieceType === 'r' || pieceType === 'q') { 
                            if ((r_attacker === targetR || c_attacker === targetC) && isPathClear(r_attacker, c_attacker, targetR, targetC, board)) {
                                return true;
                            }
                        } 
                        if (pieceType === 'b' || pieceType === 'q') { 
                             if (Math.abs(targetR - r_attacker) === Math.abs(targetC - c_attacker) && isPathClear(r_attacker, c_attacker, targetR, targetC, board)) {
                                return true;
                            }
                        }
                        if (pieceType === 'k') { 
                            if (Math.abs(targetR - r_attacker) <= 1 && Math.abs(targetC - c_attacker) <= 1) return true;
                        }
                    }
                }
            }
            return false;
        }

        function checkCastleConditions(kingFromR, kingFromC, kingToR, kingToC, board, player, castlingRights, activeSpells, currentPly, enPassantTarget) {
            const opponentColor = player === 'white' ? 'black' : 'white';
            const king = board[kingFromR][kingFromC];

            if (!king || king.hasMoved) return false; 

            if (isKingInCheck(player, board, enPassantTarget, activeSpells, currentPly)) return false;

            const isKingside = kingToC > kingFromC;

            if (isKingside) {
                if (player === 'white' && !castlingRights.white.K) return false;
                if (player === 'black' && !castlingRights.black.k) return false;
                const rook = board[kingFromR][7];
                if (!rook || rook.type.toLowerCase() !== 'r' || rook.hasMoved) return false;


                if (board[kingFromR][kingFromC + 1] || board[kingFromR][kingFromC + 2]) return false;
                
                if (isSquareAttacked(kingFromR, kingFromC + 1, opponentColor, board, enPassantTarget, activeSpells, currentPly)) return false;
                if (isSquareAttacked(kingFromR, kingFromC + 2, opponentColor, board, enPassantTarget, activeSpells, currentPly)) return false;
            } else { // Queenside
                if (player === 'white' && !castlingRights.white.Q) return false;
                if (player === 'black' && !castlingRights.black.q) return false;
                const rook = board[kingFromR][0];
                if (!rook || rook.type.toLowerCase() !== 'r' || rook.hasMoved) return false;

                if (board[kingFromR][kingFromC - 1] || board[kingFromR][kingFromC - 2] || board[kingFromR][kingFromC - 3]) return false;
                
                if (isSquareAttacked(kingFromR, kingFromC - 1, opponentColor, board, enPassantTarget, activeSpells, currentPly)) return false;
                if (isSquareAttacked(kingFromR, kingFromC - 2, opponentColor, board, enPassantTarget, activeSpells, currentPly)) return false;
            }
            return true;
        }

        function isValidMove(fromR, fromC, toR, toC, board, currentPlayer, currentEnPassantTarget, currentCastlingRights, activeSpells, currentPly) {
            const movingPiece = board[fromR][fromC];
            if (!movingPiece || movingPiece.color !== currentPlayer) return false;

            let effectivelyFrozenMovingPiece = movingPiece.isFrozen || isSquareUnderActiveFreeze(fromR, fromC, activeSpells, currentPly);
            if (effectivelyFrozenMovingPiece) return false;

            if (fromR === toR && fromC === toC) return false;

            const targetPiece = board[toR][toC];
            if (targetPiece && targetPiece.color === movingPiece.color) return false;

            const pieceType = movingPiece.type.toLowerCase();

            if (pieceType === 'k' && Math.abs(toC - fromC) === 2 && fromR === toR) {
                return checkCastleConditions(fromR, fromC, toR, toC, board, currentPlayer, currentCastlingRights, activeSpells, currentPly, currentEnPassantTarget);
            }

            let isValidSpecificMove = false;
            switch (pieceType) {
                case 'p':
                    const colorMultiplier = (movingPiece.color === 'white') ? -1 : 1;
                    if (toR === fromR + colorMultiplier && toC === fromC && !targetPiece) {
                        isValidSpecificMove = true;
                    } else if (toR === fromR + 2 * colorMultiplier && toC === fromC && !movingPiece.hasMoved && !targetPiece) {
                        const intermediateSquarePiece = board[fromR + colorMultiplier][fromC];
                        if (!intermediateSquarePiece || intermediateSquarePiece.isJumpable) {
                             isValidSpecificMove = true;
                        }
                    } else if (toR === fromR + colorMultiplier && Math.abs(toC - fromC) === 1 && targetPiece && targetPiece.color !== movingPiece.color) {
                        isValidSpecificMove = true;
                    } else if (toR === fromR + colorMultiplier && Math.abs(toC - fromC) === 1 && !targetPiece &&
                               currentEnPassantTarget && toR === currentEnPassantTarget.r && toC === currentEnPassantTarget.c) {
                        const epCapturedPawnActualR = fromR;
                        const epCapturedPawnActualC = toC;
                        const pawnToCapture = board[epCapturedPawnActualR]?.[epCapturedPawnActualC];
                        if (pawnToCapture && pawnToCapture.type.toLowerCase() === 'p' && pawnToCapture.color !== movingPiece.color) {
                             isValidSpecificMove = true;
                        }
                    }
                    break;
                case 'n':
                    const drN = Math.abs(toR - fromR);
                    const dcN = Math.abs(toC - fromC);
                    if ((drN === 2 && dcN === 1) || (drN === 1 && dcN === 2)) {
                        isValidSpecificMove = true;
                    }
                    break;
                case 'b':
                    if (Math.abs(toR - fromR) === Math.abs(toC - fromC)) {
                        if (isPathClear(fromR, fromC, toR, toC, board)) isValidSpecificMove = true;
                    }
                    break;
                case 'r':
                    if (fromR === toR || fromC === toC) {
                        if (isPathClear(fromR, fromC, toR, toC, board)) isValidSpecificMove = true;
                    }
                    break;
                case 'q':
                    if ((fromR === toR || fromC === toC) || (Math.abs(toR - fromR) === Math.abs(toC - fromC))) {
                        if (isPathClear(fromR, fromC, toR, toC, board)) isValidSpecificMove = true;
                    }
                    break;
                case 'k':
                    const drK = Math.abs(toR - fromR);
                    const dcK = Math.abs(toC - fromC);
                    if (drK <= 1 && dcK <= 1) {
                        isValidSpecificMove = true;
                    }
                    break;
            }

            if (!isValidSpecificMove) return false;

            if (targetPiece && targetPiece.type.toLowerCase() === 'k') {
                return true;
            }

            const tempBoard = board.map(row => row.map(p => p ? {...p} : null));
            const pieceToMoveCopy = tempBoard[fromR][fromC];
            tempBoard[toR][toC] = pieceToMoveCopy;
            tempBoard[fromR][fromC] = null;

            if (pieceType === 'p' && currentEnPassantTarget && toR === currentEnPassantTarget.r && toC === currentEnPassantTarget.c && !targetPiece) {
                 const epCapturedPawnActualR = fromR;
                 const epCapturedPawnActualC = toC;
                 if (tempBoard[epCapturedPawnActualR] && tempBoard[epCapturedPawnActualR][epCapturedPawnActualC]) {
                    tempBoard[epCapturedPawnActualR][epCapturedPawnActualC] = null;
                 }
            }

            let kingPos;
            const currentPlayerKingType = currentPlayer === 'white' ? 'K' : 'k';
            for (let r_king = 0; r_king < 8; r_king++) {
                for (let c_king = 0; c_king < 8; c_king++) {
                    if (tempBoard[r_king][c_king] && tempBoard[r_king][c_king].type === currentPlayerKingType) {
                        kingPos = { r: r_king, c: c_king };
                        break;
                    }
                }
                if (kingPos) break;
            }

            if (!kingPos) return true;

            const opponentColor = currentPlayer === 'white' ? 'black' : 'white';
            if (isSquareAttacked(kingPos.r, kingPos.c, opponentColor, tempBoard, null, activeSpells, currentPly )) {
                return false;
            }

            return true;
        }
        
        function getValidMovesForPiece(r_piece, c_piece) { 
            const refinedValidMoves = [];
            for (let tr = 0; tr < 8; tr++) {
                for (let tc = 0; tc < 8; tc++) {
                     if (isValidMove(r_piece, c_piece, tr, tc, gameState.board, gameState.currentPlayer, gameState.enPassantTarget, gameState.castlingRights, gameState.activeSpells, gameState.plyCount)) {
                        refinedValidMoves.push({ fromR: r_piece, fromC: c_piece, toR: tr, toC: tc });
                    }
                }
            }
            return refinedValidMoves;
        }

        function isKingInCheck(kingColor, board, enPassantTarget, activeSpells, currentPly) {
            let kingPos = null;
            const kingType = (kingColor === 'white') ? 'K' : 'k';
            const attackerColor = (kingColor === 'white') ? 'black' : 'white';

            for (let r = 0; r < 8; r++) {
                for (let c = 0; c < 8; c++) {
                    const pieceOnSquare = board[r][c];
                    if (pieceOnSquare && pieceOnSquare.type === kingType) {
                        kingPos = { r, c };
                        break;
                    }
                }
                if (kingPos) break;
            }

            if (!kingPos) return false; 
            
            return isSquareAttacked(kingPos.r, kingPos.c, attackerColor, board, enPassantTarget, activeSpells, currentPly);
        }

        function getAttackers(targetR, targetC, attackerColor, board, enPassantTarget, activeSpells, currentPly) {
            const attackers = [];
            for (let r_attacker = 0; r_attacker < 8; r_attacker++) {
                for (let c_attacker = 0; c_attacker < 8; c_attacker++) {
                    const piece = board[r_attacker][c_attacker];
                    if (!piece || piece.color !== attackerColor) continue;

                    let effectivelyFrozenAttacker = piece.isFrozen || isSquareUnderActiveFreeze(r_attacker, c_attacker, activeSpells, currentPly);
                    if (effectivelyFrozenAttacker && piece.type.toLowerCase() !== 'k') continue;

                    const pieceType = piece.type.toLowerCase();
                    let isAttacking = false;
                    
                    if (pieceType === 'p') {
                        const attackDR = (attackerColor === 'white') ? -1 : 1;
                        if (r_attacker + attackDR === targetR && Math.abs(c_attacker - targetC) === 1) isAttacking = true;
                    } else if (pieceType === 'n') {
                        const drAbs = Math.abs(targetR - r_attacker);
                        const dcAbs = Math.abs(targetC - c_attacker);
                        if ((drAbs === 2 && dcAbs === 1) || (drAbs === 1 && dcAbs === 2)) isAttacking = true;
                    } else if (pieceType === 'k') {
                        if (Math.abs(targetR - r_attacker) <= 1 && Math.abs(targetC - c_attacker) <= 1) isAttacking = true;
                    } else { // Sliding pieces
                        if ((pieceType === 'r' || pieceType === 'q') && (r_attacker === targetR || c_attacker === targetC)) {
                            if (isPathClear(r_attacker, c_attacker, targetR, targetC, board)) isAttacking = true;
                        }
                        if (!isAttacking && (pieceType === 'b' || pieceType === 'q') && (Math.abs(targetR - r_attacker) === Math.abs(targetC - c_attacker))) {
                            if (isPathClear(r_attacker, c_attacker, targetR, targetC, board)) isAttacking = true;
                        }
                    }
                    
                    if (isAttacking) {
                        attackers.push({ piece, r: r_attacker, c: c_attacker });
                    }
                }
            }
            return attackers;
        }

        function hasLegalMoves(playerColor, board, enPassantTarget, currentCastlingRights, activeSpells, currentPly, playerSpellsState, playerTurnNumberForCooldown) {
            // 1. Check for any standard legal move
            for (let r = 0; r < 8; r++) {
                for (let c = 0; c < 8; c++) {
                    const piece = board[r][c];
                    if (piece && piece.color === playerColor) {
                        let isPieceEffectivelyFrozen = piece.isFrozen || isSquareUnderActiveFreeze(r, c, activeSpells, currentPly);
                        if (isPieceEffectivelyFrozen) continue;

                        for (let toR = 0; toR < 8; toR++) {
                            for (let toC = 0; toC < 8; toC++) {
                                if (isValidMove(r, c, toR, toC, board, playerColor, enPassantTarget, currentCastlingRights, activeSpells, currentPly)) {
                                    return true; // Found a legal move
                                }
                            }
                        }
                    }
                }
            }

            // If we reach here, there are no standard legal moves.
            // If the player is not in check, it's stalemate. Spells don't create moves from nothing, they only modify existing ones.
            if (!isKingInCheck(playerColor, board, enPassantTarget, activeSpells, currentPly)) {
                return false; // Stalemate
            }

            // --- SPELL ESCAPE LOGIC (for checkmate) ---

            const canCastFreeze = playerSpellsState.freeze > 0 && (playerSpellsState.freezeLastUsedTurn === 0 || playerTurnNumberForCooldown >= playerSpellsState.freezeLastUsedTurn + 3);
            const canCastJump = playerSpellsState.jump > 0 && (playerSpellsState.jumpLastUsedTurn === 0 || playerTurnNumberForCooldown >= playerSpellsState.jumpLastUsedTurn + 3);

            // If no spells are available, it's definitely checkmate.
            if (!canCastFreeze && !canCastJump) {
                return false;
            }

            // Per user request: If a freeze spell is available, it is not checkmate.
            // This is a simple blanket rule that assumes a freeze can always be used to get out of check.
            if (canCastFreeze) {
                return true;
            }
            
            // Per user request: Jump spell logic
            if (canCastJump) {
                // Find the king and the attackers
                let kingPos = null;
                const kingType = (playerColor === 'white') ? 'K' : 'k';
                const attackerColor = (playerColor === 'white') ? 'black' : 'white';

                for (let r = 0; r < 8; r++) {
                    for (let c = 0; c < 8; c++) {
                        if (board[r][c] && board[r][c].type === kingType) {
                            kingPos = { r, c };
                            break;
                        }
                    }
                    if (kingPos) break;
                }
                 if (!kingPos) return true; // Should not happen

                const attackers = getAttackers(kingPos.r, kingPos.c, attackerColor, board, enPassantTarget, activeSpells, currentPly);

                // If it's a double check, a jump spell can't save the player.
                if (attackers.length > 1) {
                    return false;
                }

                // If it's a single check, check if using a jump can capture the attacker.
                if (attackers.length === 1) {
                    const attacker = attackers[0];
                    // Iterate through every piece on the board to make it jumpable
                    for (let jump_r = 0; jump_r < 8; jump_r++) {
                        for (let jump_c = 0; jump_c < 8; jump_c++) {
                            if (!board[jump_r][jump_c]) continue;

                            // Create a temporary board with the jumpable piece
                            const tempBoardWithJump = JSON.parse(JSON.stringify(board));
                            tempBoardWithJump[jump_r][jump_c].isJumpable = true;

                            // Now, can any of the defender's pieces capture the attacker on this temp board?
                            for (let move_r = 0; move_r < 8; move_r++) {
                                for (let move_c = 0; move_c < 8; move_c++) {
                                    const movingPiece = tempBoardWithJump[move_r][move_c];
                                    if (movingPiece && movingPiece.color === playerColor) {
                                        // Check if this piece can legally capture the attacker
                                        if (isValidMove(move_r, move_c, attacker.r, attacker.c, tempBoardWithJump, playerColor, enPassantTarget, currentCastlingRights, activeSpells, currentPly)) {
                                            return true; // Yes, we can escape checkmate!
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }

            // No standard moves, and no spell can save the day. It's checkmate.
            return false;
        }
        
        function generateMoveNotation(state, piece, fromR, fromC, toR, toC, capturedPiece, isEnPassant = false) {
            const pieceTypeUpper = piece.type.toUpperCase();
            
            if (pieceTypeUpper === 'P') {
                let notation = "";
                if (capturedPiece) {
                    notation += String.fromCharCode(97 + fromC) + 'x';
                }
                notation += String.fromCharCode(97 + toC) + (8 - toR);
                return notation;
            }

            let notation = pieceTypeUpper;

            const competitors = [];
            for (let r = 0; r < 8; r++) {
                for (let c = 0; c < 8; c++) {
                    if (r === fromR && c === fromC) continue;
                    const p = state.board[r][c];
                    if (p && p.color === piece.color && p.type === piece.type) {
                         if (isValidMove(r, c, toR, toC, state.board, state.currentPlayer, state.enPassantTarget, state.castlingRights, state.activeSpells, state.plyCount)) {
                             competitors.push({r,c});
                         }
                    }
                }
            }

            if (competitors.length > 0) {
                const fromFile = String.fromCharCode(97 + fromC);
                const fromRank = (8 - fromR).toString();

                const sameFileCompetitors = competitors.filter(comp => comp.c === fromC);
                const sameRankCompetitors = competitors.filter(comp => comp.r === fromR);
                
                if(sameFileCompetitors.length > 0 && sameRankCompetitors.length > 0) {
                     notation += fromFile + fromRank;
                }
                else if (sameFileCompetitors.length > 0) {
                    notation += fromRank;
                } else {
                    notation += fromFile;
                }
            }
            
            if (capturedPiece) {
                notation += 'x';
            }
            
            notation += String.fromCharCode(97 + toC) + (8 - toR);
            
            return notation;
        }

        function handleSpellTargeting(r_target, c_target) { 
            const targetPiece = gameState.board[r_target][c_target];
            let spellApplied = false;
            let spellNotation = "";
            const spellCaster = gameState.spellCaster; 
            const playerSpells = gameState.spells[spellCaster];
            const currentCastingGameTurn = gameState.gameTurnNumber; 

            if (gameState.spellMode === 'jump') {
                if (targetPiece) {
                    playerSpells.jump--;
                    playerSpells.jumpLastUsedTurn = currentCastingGameTurn; 
                    
                    gameState.activeSpells.push({
                        type: 'jump',
                        targetId: targetPiece.id,
                        expiresAtPly: gameState.plyCount + 2 
                    });
                    targetPiece.isJumpable = true; 
                    spellApplied = true;
                    spellNotation = `jump@${String.fromCharCode(97 + c_target)}${8 - r_target}`;
                    updateStatus(`${spellCaster.charAt(0).toUpperCase() + spellCaster.slice(1)} cast Jump on ${PIECES[targetPiece.type]} at ${String.fromCharCode(97 + c_target)}${8 - r_target}. Make your move.`);
                } else {
                    updateStatus("Jump spell must target a piece. Select a piece to Jump or Cancel.");
                    renderBoard(); 
                    updateCancelButtonVisibility(); 
                    return; 
                }
            } else if (gameState.spellMode === 'freeze') {
                playerSpells.freeze--;
                playerSpells.freezeLastUsedTurn = currentCastingGameTurn;

                const affectedPieceIds = [];
                const freezeCenterR = r_target;
                const freezeCenterC = c_target;
                
                for (let dr = -1; dr <= 1; dr++) {
                    for (let dc = -1; dc <= 1; dc++) {
                        const nr = freezeCenterR + dr; 
                        const nc = freezeCenterC + dc; 
                        if (nr >= 0 && nr < 8 && nc >= 0 && nc < 8) { 
                            const pieceToFreeze = gameState.board[nr][nc];
                            if (pieceToFreeze) {
                                affectedPieceIds.push(pieceToFreeze.id);
                            }
                        }
                    }
                }
                gameState.activeSpells.push({
                    type: 'freeze',
                    targetSquare: {r: freezeCenterR, c: freezeCenterC}, 
                    affectedPieceIds: affectedPieceIds, 
                    expiresAtPly: gameState.plyCount + 2 
                });
                spellApplied = true;
                spellNotation = `freeze@${String.fromCharCode(97 + c_target)}${8 - r_target}`;
                updateStatus(`${spellCaster.charAt(0).toUpperCase() + spellCaster.slice(1)} cast Freeze around ${String.fromCharCode(97 + c_target)}${8 - r_target}. Make your move.`);
            }

            if (spellApplied) {
                gameState.pendingSpellNotation = spellNotation;
                gameState.spellMode = null; 
            }
            renderBoard(); 
            updateSpellControls();
            updateCancelButtonVisibility();
        }

        function activateSpellMode(type) {
            if (gameState.selectedPiece) { 
                gameState.selectedPiece = null;
            }

            if (gameState.isGameOver || gameState.awaitingPromotion) return; 
            if (gameState.spellMode && gameState.spellMode !== type && gameState.spellCaster === gameState.currentPlayer) { 
                updateStatus("Another spell is already being targeted. Cancel it first.");
                return;
            }
             if (gameState.spellMode === type && gameState.spellCaster === gameState.currentPlayer) { 
                handleCancelAction(); 
                return;
            }
            if (gameState.pendingSpellNotation) { 
                updateStatus("You have already cast a spell this turn. Make your move or Cancel the cast spell.");
                return;
            }

            const playerSpells = gameState.spells[gameState.currentPlayer];
            const currentTurnForPlayerForCooldownCheck = gameState.gameTurnNumber;
            let count, lastUsedTurn, spellName;

            if (type === 'jump') {
                count = playerSpells.jump;
                lastUsedTurn = playerSpells.jumpLastUsedTurn;
                spellName = "Jump";
            } else { 
                count = playerSpells.freeze;
                lastUsedTurn = playerSpells.freezeLastUsedTurn;
                spellName = "Freeze";
            }

            if (count <= 0) {
                updateStatus(`No ${spellName} spells left.`);
                return;
            }
            if (lastUsedTurn > 0 && currentTurnForPlayerForCooldownCheck < lastUsedTurn + 3) { 
                updateStatus(`${spellName} spell is on cooldown. Available on game turn ${lastUsedTurn + 3}.`);
                return;
            }

            gameState.spellMode = type;
            gameState.spellCaster = gameState.currentPlayer;
            gameState.spellActivationState = { 
                type: type,
                originalLastUsedTurn: lastUsedTurn 
            };
            
            updateStatus(`${gameState.currentPlayer.charAt(0).toUpperCase() + gameState.currentPlayer.slice(1)} is casting ${spellName}. Select target on board or Cancel.`);
            cancelButton.textContent = "Cancel Spell";
            renderBoard(); 
            updateSpellControls(); 
            updateCancelButtonVisibility(); 
        }

        function handleCancelAction() {
            if (gameState.awaitingPromotion) {
                updateStatus("Choose a promotion piece.");
                return;
            }

            let playerDisplayTurn = "";
            const caster = gameState.spellCaster || gameState.currentPlayer; 
            if (caster) {
                 playerDisplayTurn = `${caster.charAt(0).toUpperCase() + caster.slice(1)}'s turn. `;
            }

            if (gameState.pendingSpellNotation) { 
                const playerToRefund = gameState.spellCaster; 
                const playerSpells = gameState.spells[playerToRefund];
                let cancelledSpellType = "";

                if (gameState.pendingSpellNotation.startsWith('jump@')) {
                    cancelledSpellType = 'jump';
                } else if (gameState.pendingSpellNotation.startsWith('freeze@')) {
                    cancelledSpellType = 'freeze';
                }

                let spellIndexToRemove = -1;
                for (let i = gameState.activeSpells.length - 1; i >= 0; i--) {
                    const spell = gameState.activeSpells[i];
                    if (spell.type === cancelledSpellType && spell.expiresAtPly === gameState.plyCount + 2) { 
                        spellIndexToRemove = i;
                        break;
                    }
                }
                
                if (spellIndexToRemove !== -1) {
                    const spellToCancel = gameState.activeSpells[spellIndexToRemove];
                    if (cancelledSpellType === 'jump') {
                        const jumpedPiece = findPieceById(spellToCancel.targetId);
                        if (jumpedPiece) jumpedPiece.isJumpable = false;
                        playerSpells.jump++;
                        if (gameState.spellActivationState && gameState.spellActivationState.type === 'jump') {
                            playerSpells.jumpLastUsedTurn = gameState.spellActivationState.originalLastUsedTurn;
                        }
                    } else if (cancelledSpellType === 'freeze') {
                        playerSpells.freeze++;
                        if (gameState.spellActivationState && gameState.spellActivationState.type === 'freeze') {
                            playerSpells.freezeLastUsedTurn = gameState.spellActivationState.originalLastUsedTurn;
                        }
                    }
                    gameState.activeSpells.splice(spellIndexToRemove, 1);
                }

                gameState.pendingSpellNotation = null;
                updateStatus(`${playerDisplayTurn}Spell cancelled.`);

            } else if (gameState.spellMode) { 
                updateStatus(`${playerDisplayTurn}Spell targeting cancelled.`);
            }

            gameState.spellMode = null;
            gameState.spellCaster = null;
            gameState.spellActivationState = null;
            
            updateAllUI();
        }
        
        function updateActiveSpells() {
            const stillActive = [];
            let boardNeedsRender = false;

            gameState.activeSpells.forEach(spell => {
                if (gameState.plyCount >= spell.expiresAtPly) { 
                    if (spell.type === 'freeze') {
                    } else if (spell.type === 'jump') {
                         const piece = findPieceById(spell.targetId);
                         if (piece) piece.isJumpable = false;
                    }
                    boardNeedsRender = true; 
                } else {
                    stillActive.push(spell); 
                }
            });
            gameState.activeSpells = stillActive; 
            
            if (boardNeedsRender) renderBoard(); 
        }

        function findPieceById(id) {
            for (let r_find = 0; r_find < 8; r_find++) { 
                for (let c_find = 0; c_find < 8; c_find++) {
                    if (gameState.board[r_find][c_find] && gameState.board[r_find][c_find].id === id) {
                        return gameState.board[r_find][c_find];
                    }
                }
            }
            return null;
        }

        function generateStateSignature(state) {
            const boardString = state.board.map(row => 
                row.map(p => {
                    if (!p) return ' ';
                    let char = p.type;
                    if(p.isJumpable) char += '*';
                    return char;
                }).join('')
            ).join('/');
            
            const spellCooldowns = `${state.spells.white.jumpLastUsedTurn},${state.spells.white.freezeLastUsedTurn},${state.spells.black.jumpLastUsedTurn},${state.spells.black.freezeLastUsedTurn}`;

            return `${boardString}|${state.currentPlayer}|${JSON.stringify(state.castlingRights)}|${JSON.stringify(state.enPassantTarget)}|${spellCooldowns}`;
        }
        
        function endTurn(moveNotation, movedPiece, fromR_param, toR_param, fromC_param, toC_param) {
            const isLatestMove = gameState.currentHistoryViewIndex === gameState.history.length - 1;
            if (!isLatestMove) {
                gameState.history = gameState.history.slice(0, gameState.currentHistoryViewIndex + 1);
                gameState.moveLog = gameState.moveLog.filter(log => log.plySnapshotIndex <= gameState.currentHistoryViewIndex);
                gameState.repetitionCounter = {};
                gameState.history.forEach(hist => {
                    const sig = generateStateSignature(hist);
                    gameState.repetitionCounter[sig] = (gameState.repetitionCounter[sig] || 0) + 1;
                });
            }

            const playerWhoMoved = gameState.currentPlayer; 
            
            let compactActions = [];

            if(gameState.pendingSpellNotation) {
                const [spellType, target] = gameState.pendingSpellNotation.split('@');
                compactActions.push(`${spellType.charAt(0)}@${target}`);
            }

            let compactMove = `${String.fromCharCode(97 + fromC_param)}${8-fromR_param}-${String.fromCharCode(97 + toC_param)}${8-toR_param}`;
            if (moveNotation.includes('=')) {
                compactMove += `=${moveNotation.slice(-1)}`;
            }
            compactActions.push(compactMove);
            
            gameState.plyCount++; 
            updateActiveSpells(); 

            let gameEndMessage = "";
            let isCheck = false;
            let isCheckmate = false;
            let isDraw = false;

            const opponentColor = (playerWhoMoved === 'white') ? 'black' : 'white';
            const opponentKingStillExists = gameState.board.flat().some(p => p && p.type.toLowerCase() === 'k' && p.color === opponentColor);

            if (!opponentKingStillExists) {
                isCheckmate = true; 
                gameState.isGameOver = true;
                const winner = playerWhoMoved.charAt(0).toUpperCase() + playerWhoMoved.slice(1);
                gameEndMessage = `King captured! ${winner} wins!`;
            } else {
                const nextPlayerSpells = gameState.spells[opponentColor];
                const turnForCooldownCheck = (playerWhoMoved === 'black') 
                    ? gameState.gameTurnNumber + 1 
                    : gameState.gameTurnNumber;

                if (isKingInCheck(opponentColor, gameState.board, gameState.enPassantTarget, gameState.activeSpells, gameState.plyCount)) {
                    isCheck = true;
                    if (!hasLegalMoves(opponentColor, gameState.board, gameState.enPassantTarget, gameState.castlingRights, gameState.activeSpells, gameState.plyCount, nextPlayerSpells, turnForCooldownCheck)) {
                        isCheckmate = true;
                        gameState.isGameOver = true;
                        const winner = playerWhoMoved.charAt(0).toUpperCase() + playerWhoMoved.slice(1);
                        gameEndMessage = `Checkmate! ${winner} wins!`;
                    }
                } else { 
                    if (!hasLegalMoves(opponentColor, gameState.board, gameState.enPassantTarget, gameState.castlingRights, gameState.activeSpells, gameState.plyCount, nextPlayerSpells, turnForCooldownCheck)) {
                        isDraw = true;
                        gameState.isGameOver = true;
                        gameEndMessage = "Stalemate! Draw.";
                    }
                }
            }
            
            if (!gameState.isGameOver) {
                const signature = generateStateSignature(gameState);
                gameState.repetitionCounter[signature] = (gameState.repetitionCounter[signature] || 0) + 1;
                if (gameState.repetitionCounter[signature] >= 3) {
                    isDraw = true;
                    gameState.isGameOver = true;
                    gameEndMessage = "Draw by threefold repetition.";
                }
            }
            
            let finalMoveNotationWithSymbols = gameState.pendingSpellNotation ? gameState.pendingSpellNotation + " " + moveNotation : moveNotation;
            if (isCheckmate) {
                finalMoveNotationWithSymbols += "#";
            } else if (isCheck) {
                finalMoveNotationWithSymbols += "+";
            }
            gameState.pendingSpellNotation = null;

            let next_currentPlayer_state = gameState.currentPlayer; 
            let next_gameTurnNumber_state = gameState.gameTurnNumber;
            
            if (!gameState.isGameOver) {
                if (playerWhoMoved === 'white') { 
                    next_currentPlayer_state = 'black';
                } else { 
                    next_currentPlayer_state = 'white';
                    next_gameTurnNumber_state = gameState.gameTurnNumber + 1;
                }
            }

            gameState.moveLog.push({ 
                turn: gameState.gameTurnNumber, 
                player: playerWhoMoved, 
                notation: finalMoveNotationWithSymbols, 
                actions: compactActions, 
                plySnapshotIndex: gameState.history.length
            });
            
            gameState.enPassantTarget = null; 
            if (movedPiece?.type.toLowerCase() === 'p' && Math.abs(fromR_param - toR_param) === 2) {
                gameState.enPassantTarget = { r: (fromR_param + toR_param) / 2, c: fromC_param };
            }
            gameState.spellActivationState = null; 
            gameState.spellCaster = null; 

            if (!gameState.isGameOver) {
                gameState.currentPlayer = next_currentPlayer_state;
                gameState.gameTurnNumber = next_gameTurnNumber_state;
            }

            const afterMoveState = deepCopyGameStateForSnapshot(gameState);
            afterMoveState.gameEndMessage = gameEndMessage;
            gameState.history.push(afterMoveState);
            gameState.currentHistoryViewIndex = gameState.history.length - 1;
            
            loadStateFromHistory(gameState.currentHistoryViewIndex, true);
        }
        
        function handleNotationClick(plySnapshotIndex) {
            if (gameState.awaitingPromotion) { 
                showTemporaryStatus("Please choose a promotion piece first.");
                return;
            }
            loadStateFromHistory(plySnapshotIndex, true);
        }
        
        function handleHistoryBack() {
            if (gameState.currentHistoryViewIndex > 0) {
                loadStateFromHistory(gameState.currentHistoryViewIndex - 1, true);
            }
        }

        function handleHistoryForward() {
            if (gameState.currentHistoryViewIndex < gameState.history.length - 1) {
                loadStateFromHistory(gameState.currentHistoryViewIndex + 1, true);
            }
        }

        function loadStateFromHistory(historyIndex, performFullUpdate) {
            if (historyIndex < 0 || historyIndex >= gameState.history.length) {
                console.error("Invalid historyIndex:", historyIndex);
                return;
            }
            
            gameState.currentHistoryViewIndex = historyIndex;
            const targetStateSnapshot = gameState.history[historyIndex];
            if (!targetStateSnapshot) {
                console.error("No state found in history for index:", historyIndex);
                return;
            }

            const keysToRestore = [
                'board', 'currentPlayer', 'gameTurnNumber', 
                'plyCount', 'spells', 'activeSpells', 'enPassantTarget', 'castlingRights', 
                'isGameOver', 'gameEndMessage', 'awaitingPromotion', 'useStandardPieces'
            ];

            for (const key of keysToRestore) {
                 if (Object.prototype.hasOwnProperty.call(targetStateSnapshot, key)) {
                    if (typeof targetStateSnapshot[key] === 'object' && targetStateSnapshot[key] !== null) {
                        gameState[key] = JSON.parse(JSON.stringify(targetStateSnapshot[key]));
                    } else {
                        gameState[key] = targetStateSnapshot[key];
                    }
                }
            }
            
            gameState.selectedPiece = null;
            gameState.spellMode = null;
            gameState.spellCaster = null;
            gameState.pendingSpellNotation = null;
            
            if (performFullUpdate) {
                useStandardPieces = gameState.useStandardPieces === undefined ? useStandardPieces : gameState.useStandardPieces;
                applyPieceStyle();
                updateAllUI();
            }
        }
        
        function updateAllUI() {
            updateStatusMessage();
            updateSpellControls();
            updateCancelButtonVisibility();
            updateNavigationButtons();
            updateNotationDisplay();
            renderBoard();
        }
        
        function updateStatus(message) {
            statusArea.textContent = message;
        }

        function showTemporaryStatus(message, duration = 4000) {
            clearTimeout(statusTimeout);
            updateStatus(message);
            statusTimeout = setTimeout(() => {
                updateStatusMessage(); 
            }, duration);
        }

        function updateStatusMessage() {
            clearTimeout(statusTimeout); // Prevent a pending temp message from overwriting this
            const isViewingLatest = gameState.currentHistoryViewIndex === gameState.history.length - 1;

            if (gameState.isGameOver && isViewingLatest) {
                updateStatus(gameState.gameEndMessage || "Game over.");
            } else if (gameState.isGameOver && !isViewingLatest) {
                updateStatus(`Game over. Viewing move ${gameState.currentHistoryViewIndex}.`);
            } else if (gameState.awaitingPromotion) {
                 updateStatus(`Choose promotion for pawn at ${String.fromCharCode(97 + gameState.awaitingPromotion.c)}${8 - gameState.awaitingPromotion.r}.`);
            } else {
                let statusMsg = `${gameState.currentPlayer.charAt(0).toUpperCase() + gameState.currentPlayer.slice(1)}'s turn.`;
                if (gameState.board && gameState.board.length > 0 && 
                    isKingInCheck(gameState.currentPlayer, gameState.board, gameState.enPassantTarget, gameState.activeSpells, gameState.plyCount)) {
                    statusMsg += " Check!";
                }
                updateStatus(statusMsg);
            }
        }

        function updateNotationDisplay() {
            notationArea.innerHTML = '';
            let currentTurnDiv = null;
            let lastTurnNumberProcessed = 0;

            gameState.moveLog.forEach(moveEntry => {
                if (moveEntry.turn !== lastTurnNumberProcessed) {
                    if (currentTurnDiv) {
                        notationArea.appendChild(currentTurnDiv);
                    }
                    currentTurnDiv = document.createElement('div');
                    currentTurnDiv.classList.add('notation-line');

                    const turnNumSpan = document.createElement('span');
                    turnNumSpan.classList.add('notation-turn-number');
                    turnNumSpan.textContent = `${moveEntry.turn}. `;
                    currentTurnDiv.appendChild(turnNumSpan);
                    lastTurnNumberProcessed = moveEntry.turn;
                }

                const moveSpan = document.createElement('span');
                moveSpan.classList.add('notation-move');
                moveSpan.textContent = moveEntry.notation;
                moveSpan.dataset.plySnapshotIndex = moveEntry.plySnapshotIndex;
                if (moveEntry.plySnapshotIndex === gameState.currentHistoryViewIndex) {
                    moveSpan.classList.add('current-move');
                }
                moveSpan.addEventListener('click', () => handleNotationClick(parseInt(moveSpan.dataset.plySnapshotIndex, 10)));

                if (currentTurnDiv) {
                    currentTurnDiv.appendChild(moveSpan);
                    currentTurnDiv.appendChild(document.createTextNode(' '));
                }
            });

            if (currentTurnDiv) {
                notationArea.appendChild(currentTurnDiv);
            }

            if (gameState.moveLog.length === 0) {
                notationArea.innerHTML = "";
                notationArea.scrollTop = 0;
                return;
            }

            const currentMoveLogEntry = gameState.moveLog.find(log => log.plySnapshotIndex === gameState.currentHistoryViewIndex);

            if (!currentMoveLogEntry) { // We are at the initial board state (ply 0)
                notationArea.scrollTop = 0;
                return;
            }

            const totalTurns = gameState.moveLog[gameState.moveLog.length - 1].turn;
            const currentTurnNumber = currentMoveLogEntry.turn;

            if (currentTurnNumber <= 3) {
                notationArea.scrollTop = 0;
            }
            else if (currentTurnNumber >= totalTurns - 2) {
                notationArea.scrollTop = notationArea.scrollHeight;
            }
            else {
                const scrollRatio = (currentTurnNumber - 3.5) / (totalTurns - 6);
                const maxScrollTop = notationArea.scrollHeight - notationArea.clientHeight;
                const clampedRatio = Math.max(0, Math.min(1, scrollRatio));
                notationArea.scrollTop = clampedRatio * maxScrollTop;
            }
        }
        
        function updateCancelButtonVisibility() {
            if (gameState.awaitingPromotion) {
                cancelButton.style.display = 'none';
                promotionChoicesDiv.style.display = 'flex';
                return;
            }
            promotionChoicesDiv.style.display = 'none';

            if (!gameState.isGameOver && (gameState.spellMode || gameState.pendingSpellNotation)) {
                cancelButton.style.display = 'block';
            } else {
                cancelButton.style.display = 'none';
            }
        }
        
        function updateNavigationButtons() {
            historyBackButtons.forEach(btn => btn.disabled = gameState.currentHistoryViewIndex <= 0);
            historyForwardButtons.forEach(btn => btn.disabled = gameState.currentHistoryViewIndex >= gameState.history.length - 1);
        }

        function updateSpellControls() {
            const isViewingLatest = gameState.currentHistoryViewIndex === gameState.history.length - 1;
            const disableControls = gameState.awaitingPromotion || (gameState.isGameOver && isViewingLatest);

            ['white', 'black'].forEach(player => {
                const spells = gameState.spells[player];
                let currentCastingGameTurnForCheck = gameState.gameTurnNumber;

                if (player === 'black' && gameState.currentPlayer === 'white' && gameState.plyCount > 0) {
                    currentCastingGameTurnForCheck--;
                }
                
                const spellTypes = ['jump', 'freeze'];
                spellTypes.forEach(type => {
                    const count = spells[type];
                    const lastUsedTurn = spells[`${type}LastUsedTurn`];
                    
                    const btn = document.getElementById(`${player}-${type}-spell`);
                    const countEl = document.getElementById(`${player}-${type}-count`);
                    const cooldownEl = document.getElementById(`${player}-${type}-cooldown`);
                    const iconsContainer = document.getElementById(`${player}-${type}-icons`);
                    const cooldownBarFill = document.getElementById(`${player}-${type}-cooldown-bar`);

                    countEl.textContent = count;
                    iconsContainer.innerHTML = '';
                    for (let i = 0; i < count; i++) {
                        const iconSpan = document.createElement('span');
                        iconSpan.className = 'spell-icon';
                        iconSpan.textContent = type === 'jump' ? '⚡' : '❄️';
                        iconsContainer.appendChild(iconSpan);
                    }

                    const onCooldown = lastUsedTurn > 0 && currentCastingGameTurnForCheck < lastUsedTurn + 3;

                    if (count === 0) {
                        const spellName = type.charAt(0).toUpperCase() + type.slice(1);
                        cooldownEl.textContent = `${spellName} spells depleted`;
                        cooldownBarFill.style.width = '0%';
                        cooldownBarFill.classList.remove('ready');
                    } else {
                        let progress = 1;
                        if (onCooldown) {
                            const turnsPassed = currentCastingGameTurnForCheck - lastUsedTurn;
                            progress = turnsPassed / 3;
                            cooldownEl.textContent = `Ready on turn ${lastUsedTurn + 3}`;
                            cooldownBarFill.classList.remove('ready');
                        } else {
                            cooldownEl.textContent = 'Ready';
                            cooldownBarFill.classList.add('ready');
                        }
                        cooldownBarFill.style.width = `${progress * 100}%`;
                    }

                    let btnDisabled = disableControls || 
                                       player !== gameState.currentPlayer || 
                                       count === 0 || 
                                       onCooldown ||
                                       !!gameState.pendingSpellNotation ||
                                       (gameState.spellMode && gameState.spellMode !== type && gameState.spellCaster === player);
                    btn.disabled = btnDisabled;
                    btn.classList.toggle('targeting', !disableControls && gameState.spellMode === type && gameState.spellCaster === player);
                });
            });
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const gameData = urlParams.get('game');
            
            arrowCanvas = document.getElementById('arrow-canvas');
            arrowCtx = arrowCanvas.getContext('2d');
            chessboardDiv.addEventListener('mousedown', handleMouseDownForDrawing);
            chessboardDiv.addEventListener('mouseup', handleMouseUpForDrawing);
            chessboardDiv.addEventListener('contextmenu', e => e.preventDefault());
            window.addEventListener('resize', drawAllDrawings);

            // --- Board Action Toolbar Listeners ---
            document.getElementById('flip-board-icon').addEventListener('click', handleFlipBoard);
            document.getElementById('clear-drawings-icon').addEventListener('click', () => {
                if (drawnArrows.length > 0 || drawnRings.length > 0) {
                    drawnArrows = [];
                    drawnRings = [];
                    drawAllDrawings();
                    showTemporaryStatus("Drawings cleared.");
                } else {
                    showTemporaryStatus("Right-click to draw a circle. Right-click and drag to draw an arrow. Hold Ctrl/Cmd or Shift to change color.");
                }
            });

            // --- Menu and Settings UI Logic ---
            const menuToggleButton = document.getElementById('menu-toggle-button');
            const settingsToggleButton = document.getElementById('settings-toggle-button');
            const mainMenu = document.getElementById('main-menu');
            const settingsMenu = document.getElementById('settings-menu');
            
            const setupMenu = (toggleBtn, menu, otherMenu) => {
                toggleBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    otherMenu.classList.remove('show');
                    menu.classList.toggle('show');
                });
            };
            
            setupMenu(menuToggleButton, mainMenu, settingsMenu);
            setupMenu(settingsToggleButton, settingsMenu, mainMenu);
            
            window.addEventListener('click', (e) => {
                if (!mainMenu.contains(e.target) && !menuToggleButton.contains(e.target)) {
                    mainMenu.classList.remove('show');
                }
                if (!settingsMenu.contains(e.target) && !settingsToggleButton.contains(e.target)) {
                    settingsMenu.classList.remove('show');
                }
            });

            // THEME TOGGLE LOGIC
            const toggleThemeMenuItem = document.getElementById('toggle-theme-menu-item');
            const themeIcon = toggleThemeMenuItem.querySelector('.menu-item-icon');
            const themeText = toggleThemeMenuItem.querySelector('.menu-item-text');

            function updateThemeButton() {
                if (document.body.classList.contains('dark-theme')) {
                    themeIcon.textContent = '☀️';
                    themeText.textContent = 'Switch to Light Theme';
                } else {
                    themeIcon.textContent = '🌙';
                    themeText.textContent = 'Switch to Dark Theme';
                }
            }

            toggleThemeMenuItem.addEventListener('click', () => {
                document.body.classList.toggle('dark-theme');
                if (document.body.classList.contains('dark-theme')) {
                    localStorage.removeItem('spellChessTheme'); // Dark is default, remove preference
                } else {
                    localStorage.setItem('spellChessTheme', 'light');
                }
                updateThemeButton();
            });
            updateThemeButton(); // Initial setup

            // PIECE STYLE TOGGLE
            applyPieceStyle(); // Set initial text

            // INFO BOXES VISIBILITY LOGIC
            const rulesArea = document.getElementById('rules-area');
            const closeRulesButton = document.getElementById('close-rules-button');
            const showRulesMenuItem = document.getElementById('show-rules-menu-item');

            closeRulesButton.addEventListener('click', () => { rulesArea.style.display = 'none'; });
            showRulesMenuItem.addEventListener('click', () => { 
                rulesArea.style.display = (rulesArea.style.display === 'block') ? 'none' : 'block';
            });

            const announcementBox = document.getElementById('announcement-box');
            const closeAnnouncementButton = document.getElementById('close-announcement-button');
            const showAnnouncementMenuItem = document.getElementById('show-announcement-menu-item');

            closeAnnouncementButton.addEventListener('click', () => { announcementBox.style.display = 'none'; });
            showAnnouncementMenuItem.addEventListener('click', () => {
                announcementBox.style.display = (announcementBox.style.display === 'block') ? 'none' : 'block';
            });
            
            // KEYBOARD NAVIGATION
            document.addEventListener('keydown', (event) => {
                if (event.target.tagName === 'INPUT' || event.target.tagName === 'BUTTON' || event.target.tagName === 'TEXTAREA') {
                    return;
                }
                if (event.key === 'ArrowLeft') {
                    event.preventDefault(); 
                    if (!historyBackButtons[0].disabled) handleHistoryBack();
                } else if (event.key === 'ArrowRight') {
                    event.preventDefault();
                    if (!historyForwardButtons[0].disabled) handleHistoryForward();
                }
            });


            if(gameData) {
                try {
                    const compactString = atob(decodeURIComponent(gameData));
                    resetGame(true);
                    processImportFromCompactString(compactString);
                } catch(e) {
                    console.error("Failed to load game from URL:", e);
                    showTemporaryStatus("Could not load game from URL. Starting new game.");
                    resetGame(true);
                }
            } else {
                // On initial load, try to get a game from the team game's saved file first.
                const savedDataScript = document.getElementById('savedGameStateData');
                if (savedDataScript && savedDataScript.textContent.trim() !== "") {
                    try {
                        initialGameDataFromSave = JSON.parse(savedDataScript.textContent);
                    } catch (e) {
                        console.error("Error parsing saved game data:", e);
                        initialGameDataFromSave = null;
                    }
                }
                resetGame(); 
            }
        });
        
        document.getElementById('white-jump-spell').addEventListener('click', () => activateSpellMode('jump'));
        document.getElementById('white-freeze-spell').addEventListener('click', () => activateSpellMode('freeze'));
        document.getElementById('black-jump-spell').addEventListener('click', () => activateSpellMode('jump'));
        document.getElementById('black-freeze-spell').addEventListener('click', () => activateSpellMode('freeze'));

        const copyAction = () => {
            let notationString = '';
            let lastTurnNumber = 0;
            
            if (gameState.moveLog.length === 0) {
                showTemporaryStatus("No moves to copy.");
                return;
            }

            gameState.moveLog.forEach(move => {
                if (move.turn !== lastTurnNumber) {
                    notationString += `${move.turn}. `;
                    lastTurnNumber = move.turn;
                }
                notationString += `${move.notation} `;
            });
            notationString = notationString.trim();
            
            navigator.clipboard.writeText(notationString).then(() => {
                showTemporaryStatus("Game notation copied to clipboard!");
            }).catch(err => {
                console.error('Failed to copy notation: ', err);
                showTemporaryStatus("Failed to copy. See console for details.");
            });
        };
        copyNotationButtons.forEach(btn => btn.addEventListener('click', copyAction));
        
        document.getElementById('import-game-menu-item').addEventListener('click', () => {
            importGameArea.style.display = 'block';
        });

        cancelImportButton.addEventListener('click', () => {
            importGameArea.style.display = 'none';
        });

        loadGameButton.addEventListener('click', () => {
            const notationText = importGameTextarea.value.trim();
            if (!notationText) {
                showTemporaryStatus("Notation field is empty.");
                return;
            }
            processImport(notationText);
            importGameArea.style.display = 'none';
            importGameTextarea.value = '';
        });
        
        function parseAlgebraicToCoords(alg) {
            if (!alg || alg.length !== 2) return null;
            const file = alg.charCodeAt(0) - 'a'.charCodeAt(0);
            const rank = 8 - parseInt(alg[1], 10);
            if (file < 0 || file > 7 || isNaN(rank) || rank < 0 || rank > 7) return null;
            return { r: rank, c: file };
        }

        async function processImport(notationText) {
            resetGame(true);
            updateStatus("Importing game...");
            
            let tokens = notationText.replace(/\d+\./g, '').trim().split(/\s+/);
            const lastToken = tokens[tokens.length-1].toUpperCase();
            let gameResultToken = null;

            if(['T', 'R', 'D'].includes(lastToken)) {
                gameResultToken = tokens.pop();
            }
            
            for (const token of tokens) {
                 if (gameState.isGameOver) break;

                if (token.includes('@')) { // It's a spell
                    const [spellTypeStr, targetSquare] = token.split('@');
                    const spellType = spellTypeStr === 'jump' ? 'jump' : 'freeze';
                    const coords = parseAlgebraicToCoords(targetSquare);
                    if (!coords) {
                        showTemporaryStatus(`Invalid spell target: ${token}`);
                        resetGame(true);
                        return;
                    }
                    activateSpellMode(spellType);
                    handleSpellTargeting(coords.r, coords.c);

                } else { // It's a move
                    const moveCoords = findMoveFromSAN(token);
                    if (!moveCoords) {
                        showTemporaryStatus(`Could not find a legal move for: "${token}" for ${gameState.currentPlayer}. Import failed.`);
                        resetGame(true);
                        return;
                    }
                    
                    onSquareClick(moveCoords.fromR, moveCoords.fromC);
                    onSquareClick(moveCoords.toR, moveCoords.toC);

                    if (token.includes('=')) {
                        const promotionPiece = token.split('=')[1][0];
                         if (gameState.awaitingPromotion) {
                             const promotionButton = promotionChoicesDiv.querySelector(`[data-promote="${promotionPiece.toUpperCase()}"]`);
                             if (promotionButton) {
                                 promotionButton.click();
                             } else {
                                showTemporaryStatus(`Invalid promotion piece in: ${token}`);
                                resetGame(true);
                                return;
                             }
                         }
                    }
                }
                 await new Promise(resolve => setTimeout(resolve, 10)); 
            }

            if(gameResultToken) {
                gameState.isGameOver = true;
                let player = gameState.currentPlayer;
                let winner = player === 'white' ? 'Black' : 'White';
                let message = "";
                let notation = "";

                switch(gameResultToken.toUpperCase()) {
                    case 'T':
                        message = `${winner} wins by timeout.`;
                        notation = "T";
                        break;
                    case 'R':
                        winner = player === 'white' ? 'Black' : 'White';
                        message = `${winner} wins by resignation.`;
                        notation = "R";
                        break;
                    case 'D':
                        message = "Draw by agreement.";
                        notation = "D";
                        break;
                }
                gameState.gameEndMessage = message;
                 gameState.moveLog.push({ 
                    turn: gameState.gameTurnNumber, 
                    player: player, 
                    notation: notation, 
                    actions: [], 
                    plySnapshotIndex: gameState.history.length
                });
            }

            updateStatus("Game import complete!");
            loadStateFromHistory(gameState.history.length-1, true);
        }

        function findMoveFromSAN(san) {
            if (san.startsWith('O-O-O') || san.startsWith('0-0-0')) {
                const r = gameState.currentPlayer === 'white' ? 7 : 0;
                return { fromR: r, fromC: 4, toR: r, toC: 2 };
            }
            if (san.startsWith('O-O') || san.startsWith('0-0')) {
                const r = gameState.currentPlayer === 'white' ? 7 : 0;
                return { fromR: r, fromC: 4, toR: r, toC: 6 };
            }

            let pieceType;
            let toSquare;
            let fromFile = -1, fromRank = -1;
            
            let cleanSan = san.replace(/[x+#=]/g, '').replace('e.p.', '');
            
            if ('RNBQK'.includes(cleanSan[0])) {
                pieceType = cleanSan[0];
                cleanSan = cleanSan.substring(1);
            } else {
                pieceType = 'P';
            }

            if (cleanSan.length > 2 && 'RNBQ'.includes(cleanSan.slice(-1))) {
                cleanSan = cleanSan.slice(0, -1);
            }

            toSquare = cleanSan.slice(-2);
            const disambiguation = cleanSan.slice(0, -2);
            if (disambiguation) {
                if (disambiguation.length === 1) {
                    if ('abcdefgh'.includes(disambiguation)) {
                        fromFile = disambiguation.charCodeAt(0) - 'a'.charCodeAt(0);
                    } else {
                        fromRank = 8 - parseInt(disambiguation, 10);
                    }
                } else if (disambiguation.length === 2) {
                    fromFile = disambiguation.charCodeAt(0) - 'a'.charCodeAt(0);
                    fromRank = 8 - parseInt(disambiguation[1], 10);
                }
            }
            
            const toCoords = parseAlgebraicToCoords(toSquare);
            if (!toCoords) return null;

            const candidatePieces = [];
            for (let r = 0; r < 8; r++) {
                for (let c = 0; c < 8; c++) {
                    const p = gameState.board[r][c];
                    if (p && p.color === gameState.currentPlayer && p.type.toUpperCase() === pieceType) {
                        candidatePieces.push({ r, c });
                    }
                }
            }

            for (const candidate of candidatePieces) {
                if (fromFile !== -1 && candidate.c !== fromFile) continue;
                if (fromRank !== -1 && candidate.r !== fromRank) continue;

                if (isValidMove(candidate.r, candidate.c, toCoords.r, toCoords.c, gameState.board, gameState.currentPlayer, gameState.enPassantTarget, gameState.castlingRights, gameState.activeSpells, gameState.plyCount)) {
                    return { fromR: candidate.r, fromC: candidate.c, toR: toCoords.r, toC: toCoords.c };
                }
            }

            return null;
        }
        
        async function processImportFromCompactString(compactString) {
            updateStatus("Importing game from URL...");
            const actions = compactString.split(',');

            for (const action of actions) {
                if (gameState.isGameOver) break;

                if (action.includes('@')) { // Spell
                    const [spellTypeChar, targetSquare] = action.split('@');
                    const spellType = spellTypeChar === 'j' ? 'jump' : 'freeze';
                    const coords = parseAlgebraicToCoords(targetSquare);
                    if (!coords) throw new Error(`Invalid spell target in URL: ${action}`);
                    activateSpellMode(spellType);
                    handleSpellTargeting(coords.r, coords.c);

                } else { // Move
                    const [fromAlg, toAndPromo] = action.split('-');
                    const toAlg = toAndPromo.substring(0, 2);
                    const fromCoords = parseAlgebraicToCoords(fromAlg);
                    const toCoords = parseAlgebraicToCoords(toAlg);
                    if (!fromCoords || !toCoords) throw new Error(`Invalid move coordinates in URL: ${action}`);

                    onSquareClick(fromCoords.r, fromCoords.c);
                    onSquareClick(toCoords.r, toCoords.c);
                    
                    if (toAndPromo.includes('=')) {
                        const promoPiece = toAndPromo.split('=')[1];
                        if (gameState.awaitingPromotion) {
                            const promoButton = promotionChoicesDiv.querySelector(`[data-promote="${promoPiece}"]`);
                            if (promoButton) {
                                promoButton.click();
                            } else {
                                throw new Error(`Invalid promotion in URL: ${action}`);
                            }
                        }
                    }
                }
                 await new Promise(resolve => setTimeout(resolve, 10));
            }
            updateStatus("Game loaded from URL successfully!");
        }
        
    </script>





</body></html>
